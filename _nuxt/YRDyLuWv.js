import{q as X,n as Z,p as G,o as P,c as K,a as n,d as j,s as b,v as tt,u as i,x as et,F as $,y as I,t as A,z as V,A as nt,g as rt,b as J,B as U,l as st,_ as ct}from"./CX2W2PHd.js";import{P as ot,U as at,l as C}from"./BXcYWNav.js";import{_ as ut}from"./CTpDAO2y.js";import{u as lt}from"./D61gXyfo.js";import{a as B,B as W}from"./CB678u4y.js";import{u as it}from"./wkpgy-CZ.js";import{u as dt}from"./CBrMPCze.js";const mt=e=>new Promise(function(f,u){ot.parse(e,{download:!0,header:!0,skipEmptyLines:!0,complete:f,error:u})}),pt="/gviz/tq?tqx=out:csv",ft="&sheet=perioden",ht=at+pt+ft,q=X("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const e=await mt(ht);this._perioden=e.data,this._currentPeriod=this._perioden[0].Periode},setPeriod(e){this._currentPeriod=e}},getters:{reparaturpauschale:e=>p=>e._perioden.find(f=>f.Periode===p).Reparaturpauschale,listOfPeriods:e=>e._perioden.map(p=>p.Periode),currentPeriod:e=>e._currentPeriod}}),yt={id:"my-global"},_t=Z({__name:"YearSwitch",async setup(e){let p,f;const u=q();[p,f]=G(()=>u.loadDataFromGoogle()),await p,f();const t=u.listOfPeriods;let x=u.currentPeriod;const y=()=>{C(`


changeFinancialYear`,x),u.setPeriod(x)};return(S,r)=>(P(),K("form",yt,[n("span",null,[r[2]||(r[2]=j("Welches Jahr möchtest du sehen?")),b(n("select",{"onUpdate:modelValue":r[0]||(r[0]=L=>et(x)?x.value=L:x=L),onChange:r[1]||(r[1]=L=>y())},[(P(!0),K($,null,I(i(t),L=>(P(),K("option",null,A(L),1))),256))],544),[[tt,i(x)]])])]))}}),E=(e,p,f)=>{if(e===null)return;const u=new B(e.nr,e.date,e.soll,e.haben,e.description,e.kmStart),t=new B(e.nr,e.date,e.haben,e.soll,e.description,e.kmStart);p.bookings.push(u),f.bookings.push(t)},At=e=>e.key.indexOf("an: ")===0,St=e=>e.key.indexOf("Jahresbeitrag")===0,T=e=>+(e.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(e.description)>0,_=e=>typeof e=="string"?parseFloat(e.replaceAll(".","").replace("€","").trim().replace(",",".")):Number.isNaN(e)?0:e,Bt=e=>T(e)?+e.liters.replace("l","").trim().replace(",","."):0;let R=0,F=0;const vt=(e,p,f,u)=>{for(var t of p){let y=!1;const S=f.shVerteilung(t.account).split(",");S.length>1;for(var x of S){const r=x.trim();if(!e.findAccount(r,"Konto 1")){C("Error: Konto nicht gefunden: ",r,t);const s=e.findAccount("System","Errors"),o=e.findAccount("System","Errors1"),c="Konto "+r+" nicht gefunden",d=new B(t.nr,t.date,0,_(t.amount),c,+t.km);E(d,s,o),y=!0}if(St(t)){const s=e.findAccount("Bussi","Konto 1"),o=e.findAccount(r,"Konto 1"),c=_(t.amount)/S.length,d=t.account+" Jahresbeitrag "+t.description+" "+c+" "+t.amount,m=new B(t.nr,t.date,0,c,d,+t.km);E(m,s,o),y=!0}if(At(t)){const s=e.findAccount(r,"Ausgleichskonto"),o=e.findAccount(t.key.slice(4),"Ausgleichskonto"),c=_(t.amount)/S.length,d=t.account+" Ausgleichsbuchung an "+t.key.slice(4)+" "+c,m=new B(t.nr,t.date,0,c,d,+t.km-+(t.kmSinceLastEntry||"0"));E(m,s,o),y=!0,C("bookEverythingtoBS: ausgleichbuchung gefunden ",t.key,t.key.slice(4),s,o,m)}if(T(t)&&(_(t.fuelPriceInEuro)&&(R=Math.round(1e3*_(t.fuelPriceInEuro))/1e3),t.consumption&&+t.consumption!=0&&(F=Math.round(100*t.consumption)/100,F<8||F>11))){const s=e.findAccount("System","Errors"),o=e.findAccount("System","Errors1"),c="falscher Verbrauchswert:   "+F+"  Liter/100km<br>"+t.account+" Verbrauch "+t.description+" <br> amount:"+t.amount+" "+_(t.amount)+"<br> kmSinceLastEntry:"+t.kmSinceLastEntry+"<br> splits:"+S+"<br> booking:"+JSON.stringify(t),d=new B(t.nr,t.date,0,_(t.amount),c,+t.km);E(d,s,o)}if((s=>+s.key>0||s.key.indexOf("Reparatur")>-1)(t)){const s=e.findAccount(r,"Konto 3"),o=e.findAccount("Bussi","Konto 3"),c=_(t.amount)/S.length,d=t.account+" Reparatur "+t.description+" "+c+" "+t.amount,m=new B(t.nr,t.date,0,c,d,+t.km-+(t.kmSinceLastEntry||"0"));E(m,s,o),y=!0}if((s=>parseFloat(s.kmSinceLastEntry+"")!=0)(t)){const s=e.findAccount(r,"Kilometer"),o=e.findAccount("Bussi","Kilometer"),c=parseFloat(t.kmSinceLastEntry||"0")/S.length,m=+t.km-parseFloat(t.kmSinceLastEntry||"0"),z=Math.round(R*c*F)/100,l=Math.round(100*+u.reparaturpauschale(u.currentPeriod).replace(",",".")*c)/100,a=t.account+" Kilometer "+c+" von "+t.kmSinceLastEntry+" km, "+r+"-->Bussi "+t.description+"<br>Benzingeld: "+z+" €, Reparaturgeld: "+l+" € für "+c+" km",M=new B(t.nr,t.date,c,0,a,m);E(M,s,o),y=!0;const D=e.findAccount(r,"Konto 2"),v=e.findAccount("Bussi","Konto 2"),w="Benzingeld: "+r+"-->Bussi, "+z+" € für "+c+" km, Benzinpreis: "+R+"€/L, Verbrauch: "+F+" ="+Math.round(R*F)/100+"€/km",Y=new B(t.nr,t.date,z,0,w,m);E(Y,D,v);const H=e.findAccount("Bussi","Konto 3"),g=e.findAccount(r,"Konto 3"),Q=new B(t.nr,t.date,0,l,"Reparaturpauschale "+u.reparaturpauschale(u.currentPeriod)+" €/km * "+c+" km = "+l+" € : "+r+" --> Bussi",m);E(Q,H,g)}if(T(t)){const s=Math.round(100*_(t.amount))/100,o=e.findAccount("Bussi","Konto 2"),c=e.findAccount(r,"Konto 2"),d=t.account+": Tanken für "+s+"€, "+Bt(t)+" Liter, <br> Verbrauch: "+F+" l/100km, <br>"+r+"-->Bussi<br>Benzinpreis: "+R+" €/l",m=_(t.amount)/S.length,l=+t.km-parseFloat(t.kmSinceLastEntry||"0"),a=new B(t.nr,t.date,m,0,d,l);E(a,o,c),y=!0}if((s=>s.key==="gleich")(t)){const s=e.findAccount(r,"Konto 1"),o=e.findAccount("Bussi","Konto 1"),c=_(t.amount)/S.length,d=t.account+" Konto 1 "+t.description+" "+c+" "+t.amount,m=new B(t.nr,t.date,0,c,d,+t.km);E(m,s,o),y=!0}const N=s=>{const o=t&&t.key&&typeof t.key=="string"&&t.key.split(" ").length>0?t.key.split(" ")[1]:"";return s.key.split(" ")[0]==="an"&&o!==""&&(o==="Bussi"||f.personen.indexOf(o)>=0)};if(N(t)){const s=e.findAccount(r,"Ausgleichskonto"),o=t.key.split(" ")[1],c=e.findAccount(o,"Ausgleichskonto"),d=t.account+"-->"+o+": "+t.description+" "+_(t.amount)+" "+t.amount,m=new B(t.nr,t.date,0,_(t.amount),d,+t.km);E(m,s,c),y=!0}if((s=>s.key.toLowerCase()==="jahresendbuchung")(t)){const s=t.description.match("[A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]* -> [A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]*"),o=s?s[0]:"";if(o==="")return e;const c=o.split(" -> ")[0].split(":")[0],d=o.split(" -> ")[1].split(":")[0],m=o.split(" -> ")[0].split(":")[1],z=o.split(" -> ")[1].split(":")[1],l=e.findAccount(c,m),a=e.findAccount(d,z),M=new B(t.nr,t.date,_(t.amount),0,t.description,+t.km);E(M,l,a),y=!0}if(_(t.amount)===0&&+(t.kmSinceLastEntry||"0")==0&&(y=!0,C("Nullbuchung ignoriert: "+t+"  km:"+t.kmSinceLastEntry+" €:"+t.amount)),!y){C("Fehler: ",t,N(t));const s=e.findAccount("System","Errors"),o=e.findAccount("System","Errors1"),c=t.account+" Konto 1 "+t.description+" <br> amount:"+t.amount+" "+_(t.amount)+"<br> kmSinceLastEntry:"+t.kmSinceLastEntry+"<br> splits:"+S+"<br> booking:"+JSON.stringify(t),d=new B(t.nr,t.date,0,_(t.amount),c,+t.km);E(d,s,o)}}}return e},Et={key:0},wt={key:1},Pt={class:"center"},Kt={key:0},xt={key:2},Lt=["onClick"],Nt={class:"inner",style:{width:"100%"}},zt={class:"inner"},Ft={class:"inner"},Ct=["onClick"],Ot={class:"inner"},Mt={class:"inner"},Rt={class:"inner grey"},Vt={class:"inner grey"},Gt=Z({__name:"balance",async setup(e){let p,f;const u=V({bookings:[],name:""}),t=l=>{const a=l.bookings;u.bookings.splice(0,u.bookings.length),u.bookings.push(...a),u.name=l.owner+" "+l.name},x=()=>{u.bookings=[],u.name=""};nt(()=>{window.addEventListener("keydown",l=>{l.key==="Enter"&&l.metaKey&&x()})});const y=lt();[p,f]=G(()=>y.loadStakeholder()),await p,f();const S=y.stakeholder.filter(l=>l.Verteilung.indexOf(",")===-1).map(l=>l.Verteilung),r=q();[p,f]=G(()=>r.loadDataFromGoogle()),await p,f(),C("balance.currentPeriod ",r.currentPeriod,r);const L=it(),O=dt();[p,f]=G(()=>O.loadDataFromGoogle()),await p,f(),O.accountBezeichnungen;const k=O.accountNames;let N=V(L.bookings),h=V(new W(S,k,N));h.findAccount("System","Errors");const s=st();rt(r.$state,async(l,a)=>{await L.loadBussiData(r.currentPeriod),N=V(L.bookings),h=new W(S,k,N),h=vt(h,N,y,r),s&&s.proxy&&s.proxy.$forceUpdate(),u.bookings=[],u.name=""});const o=()=>h.findAccount("Bussi","Kilometer").saldoY(r.currentPeriod),c=()=>Math.round(N.reduce((l,a)=>l+z(a),0)),d=()=>Math.round(100*c()*2.37/1e3)/100,m=()=>Math.round(c()/o()*1e4)/100,z=l=>T(l)?+l.liters.replace("l","").trim().replace(",","."):0;return C("bs after bookEverythingtoBS",h),(l,a)=>{const M=_t,D=ut;return P(),K("div",null,[J(M),n("h1",null,"Bilanz: "+A(i(r).currentPeriod)+", "+A(i(N).length)+" Buchungen ",1),i(h).findAccount("Bussi","Errors").bookings.length>0?(P(),K("div",Et,[n("a",{class:"errors",href:"#",onClick:a[0]||(a[0]=v=>t(i(h).findAccount("Bussi","Errors")))}," Errors: "+A(i(h).findAccount("Bussi","Errors").bookings.length),1)])):U("",!0),n("div",null,"Kilometer: "+A(o())+" km",1),n("div",null,"Benzin: "+A(c())+" Liter",1),n("div",null,"CO2: "+A(d())+" Tonnen CO2 ",1),n("div",null,"Verbrauch: "+A(m())+" Liter/100km",1),n("div",null,"Reparaturpauschale: "+A(i(r).reparaturpauschale(i(r).currentPeriod))+"€",1),a[6]||(a[6]=n("div",null," ",-1)),u.bookings.length!=0?(P(),K("div",wt,[n("div",Pt,[n("button",{class:"green",onClick:a[1]||(a[1]=v=>x())},"hit ⌘+<Enter> to go back to the table"),a[2]||(a[2]=n("br",null,null,-1)),a[3]||(a[3]=n("br",null,null,-1)),u.bookings.length>0?(P(),K("div",Kt)):U("",!0),J(D,{selectedBookingsToRender:u.bookings,konto:u.name},null,8,["selectedBookingsToRender","konto"])])])):(P(),K("div",xt,[n("table",null,[n("tbody",null,[(P(!0),K($,null,I(i(S),v=>(P(),K("tr",null,[n("td",null,[j(A(v),1),n("a",{href:"#",onClick:w=>t(i(h).findAccount(v,"Kilometer"))},[n("div",null,"Kilometer: "+A(Math.abs(i(h).findAccount(v,"Kilometer").saldoY(i(r).currentPeriod)))+" km",1)],8,Lt),n("div",null,[n("b",null,"Saldo: "+A(i(h).saldierenEuro(v))+" €",1)])]),n("td",null,[n("table",Nt,[n("tbody",null,[a[5]||(a[5]=n("tr",null,[n("th",{class:"inner"},"Kontobezeichnung "),n("th",{class:"innter"},"#Buchungen"),n("th",{class:"inner"},"Saldo "),n("th",{class:"inner grey"},"Soll"),n("th",{class:"inner grey"},"Haben")],-1)),(P(!0),K($,null,I(i(O).accounts.filter(w=>w.Name!=="Kilometer"&&(w.Name!=="Konto 9000"||v==="Bussi")),w=>(P(),K("tr",zt,[n("td",Ft,[n("a",{href:"#",onClick:Y=>t(i(h).findAccount(v,w.Name))},[n("span",null,A(w.Bezeichnung),1)],8,Ct),a[4]||(a[4]=n("span",null,"     ",-1))]),n("td",Ot,A(i(h).findAccount(v,w.Name).bookings.length),1),n("td",Mt,A(i(h).findAccount(v,w.Name).saldoY(i(r).currentPeriod))+" €",1),n("td",Rt,A(i(h).findAccount(v,w.Name).saldoSoll(i(r).currentPeriod))+" €",1),n("td",Vt,A(i(h).findAccount(v,w.Name).saldoHaben(i(r).currentPeriod))+" € ",1)]))),256))])])])]))),256))])])])),a[7]||(a[7]=n("br",null,null,-1)),a[8]||(a[8]=n("br",null,null,-1))])}}}),Ut=ct(Gt,[["__scopeId","data-v-112ce69c"]]);export{Ut as default};
