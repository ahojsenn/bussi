import{G as ue,f as re,w as Z,o as E,b as x,i as r,h as se,x as ie,H as le,u as l,z as de,F as Q,s as X,t as A,j as W,q as me,k as he,e as b,v as ee,C as pe,D as fe,I as _e,a as ye}from"./entry.8f8fde29.js";import{P as Ae,U as ve,l as R,_ as we}from"./url.da8cc794.js";import{u as Se}from"./stakeholder.f64f4ed7.js";import{a as v,B as te}from"./types.3d83ab55.js";import{u as Be}from"./hauptbuch.99fc1a00.js";import{u as Pe}from"./accounts.79e5ac0b.js";const Ee=t=>new Promise(function(h,u){Ae.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:h,error:u})}),xe="/gviz/tq?tqx=out:csv",Ke="&sheet=perioden",ke=ve+xe+Ke,oe=ue("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const t=await Ee(ke);this._perioden=t.data,this._currentPeriod=this._perioden[0].Periode},setPeriod(t){this._currentPeriod=t}},getters:{reparaturpauschale:t=>m=>t._perioden.find(h=>h.Periode===m).Reparaturpauschale,listOfPeriods:t=>t._perioden.map(m=>m.Periode),currentPeriod:t=>t._currentPeriod}}),ge={id:"my-global"},Le=re({__name:"YearSwitch",async setup(t){let m,h;const u=oe();[m,h]=Z(()=>u.loadDataFromGoogle()),await m,h();const e=u.listOfPeriods;let g=u.currentPeriod;const f=()=>{u.setPeriod(g)};return(w,n)=>(E(),x("form",ge,[r("span",null,[se("Welches Jahr möchtest du sehen?"),ie(r("select",{"onUpdate:modelValue":n[0]||(n[0]=L=>de(g)?g.value=L:g=L),onChange:n[1]||(n[1]=L=>f())},[(E(!0),x(Q,null,X(l(e),L=>(E(),x("option",null,A(L),1))),256))],544),[[le,l(g)]])])]))}}),P=(t,m,h)=>{if(t===null)return;const u=new v(t.nr,t.date,t.soll,t.haben,t.description,t.kmStart),e=new v(t.nr,t.date,t.haben,t.soll,t.description,t.kmStart);m.bookings.push(u),h.bookings.push(e)},ze=t=>t.key.indexOf("an: ")===0,q=t=>+(t.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(t.description)>0,ne=t=>t.toFixed(2).replace(".",",")+" €",Ne=t=>Math.round(t*100)/100,B=t=>typeof t=="string"?parseFloat(t.replaceAll(".","").replace("€","").trim().replace(",",".")):Number.isNaN(t)?0:t,Ce=t=>q(t)?+t.liters.replace("l","").trim().replace(",","."):0;let Y=0,U=0;const Fe=(t,m,h,u)=>{R("bookEverythingtoBS: ",u.currentPeriod);for(var e of m){let f=!1;const w=h.shVerteilung(e.account).split(",");w.length>1;for(var g of w){const n=g.trim();if(ze(e)){const s=t.findAccount(n,"Ausgleichskonto"),c=t.findAccount(e.key.slice(4),"Ausgleichskonto"),a=B(e.amount)/w.length,y=e.account+" Ausgleichsbuchung an "+e.key.slice(4)+" "+a,p=new v(e.nr,e.date,0,a,y,+e.km-+(e.kmSinceLastEntry||"0"));P(p,s,c),f=!0,R("bookEverythingtoBS: ausgleichbuchung gefunden ",e.key,e.key.slice(4),s,c,p)}if(q(e)&&(B(e.fuelPriceInEuro)&&(Y=Math.round(1e3*B(e.fuelPriceInEuro))/1e3),e.consumption&&+e.consumption!=0&&(U=Math.round(100*e.consumption)/100)),(s=>+s.key>0||s.key.indexOf("Reparatur")>-1)(e)){const s=t.findAccount(n,"Konto 3"),c=t.findAccount("Bussi","Konto 3"),a=B(e.amount)/w.length,y=e.account+" Reparatur "+e.description+" "+a+" "+e.amount,p=new v(e.nr,e.date,0,a,y,+e.km-+(e.kmSinceLastEntry||"0"));P(p,s,c),f=!0}if((s=>parseFloat(s.kmSinceLastEntry+"")!=0)(e)){const s=t.findAccount(n,"Kilometer"),c=t.findAccount("Bussi","Kilometer"),a=parseFloat(e.kmSinceLastEntry||"0")/w.length;+e.km-parseFloat(e.kmSinceLastEntry||"0");const p=Math.round(Y*a*U)/100,N=Math.round(100*+u.reparaturpauschale(u.currentPeriod).replace(",",".")*a)/100,I=e.account+" Kilometer "+a+" von "+e.kmSinceLastEntry+" km, "+n+"-->Bussi "+e.description+"<br>Benzingeld: "+p+" €, Reparaturgeld: "+N+" € für "+a+" km",T=new v(e.nr,e.date,a,0,I);P(T,s,c),f=!0;const o=t.findAccount(n,"Konto 2"),S=t.findAccount("Bussi","Konto 2"),C="Benzingeld: "+n+"-->Bussi, "+p+" € für "+a+" km, Benzinpreis: "+Y+"€/L, Verbrauch: "+U+" ="+Math.round(Y*U)/100+"€/km",z=new v(e.nr,e.date,p,0,C);P(z,o,S);const d=t.findAccount("Bussi","Konto 3"),_=t.findAccount(n,"Konto 3"),O=new v(e.nr,e.date,0,N,"Reparaturpauschale "+u.reparaturpauschale(u.currentPeriod)+" €/km * "+a+" km = "+N+" € : "+n+" --> Bussi");P(O,d,_)}if(q(e)){const s=Math.round(100*B(e.amount))/100,c=t.findAccount("Bussi","Konto 2"),a=t.findAccount(n,"Konto 2"),y=e.account+": Tanken für "+s+"€, "+Ce(e)+" Liter, <br> Verbrauch: "+U+" l/100km, <br>"+n+"-->Bussi<br>Benzinpreis: "+Y+" €/l",p=B(e.amount)/w.length,N=new v(e.nr,e.date,p,0,y);P(N,c,a),f=!0}if((s=>s.key==="gleich")(e)){const s=t.findAccount(n,"Konto 1"),c=t.findAccount("Bussi","Konto 1"),a=B(e.amount)/w.length,y=e.account+" Konto 1 "+e.description+" "+a+" "+e.amount,p=new v(e.nr,e.date,0,a,y,+e.km);P(p,s,c),f=!0}const K=s=>{const c=e&&e.key&&typeof e.key=="string"&&e.key.split(" ").length>0?e.key.split(" ")[1]:"";return s.key.split(" ")[0]==="an"&&c!==""&&(c==="Bussi"||h.personen.indexOf(c)>=0)};if(K(e)){const s=t.findAccount(n,"Ausgleichskonto"),c=e.key.split(" ")[1],a=t.findAccount(c,"Ausgleichskonto"),y=e.account+"-->"+c+": "+e.description+" "+B(e.amount)+" "+e.amount,p=new v(e.nr,e.date,0,B(e.amount),y,+e.km);P(p,s,a),f=!0}if((s=>s.key.toLowerCase()==="jahresendbuchung")(e)){const s=e.description.match("[A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]* -> [A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]*"),c=s?s[0]:"";if(c==="")return t;const a=c.split(" -> ")[0].split(":")[0],y=c.split(" -> ")[1].split(":")[0],p=c.split(" -> ")[0].split(":")[1],N=c.split(" -> ")[1].split(":")[1],I=t.findAccount(a,p),T=t.findAccount(y,N),o=new v(e.nr,e.date,B(e.amount),0,e.description,+e.km);P(o,I,T),f=!0}if(B(e.amount)===0&&+(e.kmSinceLastEntry||"0")==0&&(f=!0,R("Nullbuchung ignoriert: "+e+"  km:"+e.kmSinceLastEntry+" €:"+e.amount)),!f){R("Fehler: ",e,K(e));const s=t.findAccount("System","Errors"),c=t.findAccount("System","Errors1"),a=e.account+" Konto 1 "+e.description+" <br> amount:"+e.amount+" "+B(e.amount)+"<br> kmSinceLastEntry:"+e.kmSinceLastEntry+"<br> splits:"+w+"<br> booking:"+JSON.stringify(e),y=new v(e.nr,e.date,0,B(e.amount),a,+e.km);P(y,s,c)}}}return t},M=t=>(pe("data-v-69cff240"),t=t(),fe(),t),Me={key:0},Oe=M(()=>r("div",null," ",-1)),Re={key:1},Ge={class:"center"},Ie={key:0},Te={key:2},Ve=["onClick"],De={class:"inner",style:{width:"100%"}},$e=M(()=>r("th",{class:"inner"},"Kontobezeichnung ",-1)),Ye=M(()=>r("th",{class:"inner"},"Saldo ",-1)),Ue=M(()=>r("th",{class:"inner grey"},"Soll",-1)),je=M(()=>r("th",{class:"inner grey"},"Haben",-1)),He={class:"inner"},We={class:"inner"},Ze=["onClick"],qe=M(()=>r("span",null,"     ",-1)),Je={class:"inner"},Qe={class:"inner grey"},Xe={class:"inner grey"},be=M(()=>r("br",null,null,-1)),et=M(()=>r("br",null,null,-1)),tt=re({__name:"balance",async setup(t){let m,h;const u=W({bookings:[],name:""}),e=o=>{const S=o.bookings;u.bookings.splice(0,u.bookings.length),u.bookings.push(...S),u.name=o.owner+" "+o.name},g=()=>{u.bookings=[],u.name=""};me(()=>{window.addEventListener("keydown",o=>{o.key==="Enter"&&o.metaKey&&g()})});const f=Se();[m,h]=Z(()=>f.loadStakeholder()),await m,h();const w=f.stakeholder.filter(o=>o.Verteilung.indexOf(",")===-1).map(o=>o.Verteilung),n=oe();[m,h]=Z(()=>n.loadDataFromGoogle()),await m,h(),R("balance.currentPeriod ",n.currentPeriod,n);const L=Be(),G=Pe();[m,h]=Z(()=>G.loadDataFromGoogle()),await m,h(),G.accountBezeichnungen;const J=G.accountNames;let K=W(L.bookings),i=W(new te(w,J,K));i.findAccount("System","Errors");const s=_e();he(n.$state,async(o,S)=>{await L.loadBussiData(n.currentPeriod),K=W(L.bookings),i=new te(w,J,K),i=Fe(i,K,f,n),i=I(i,K,f,n),i=T(i,K,f,n),s&&s.proxy&&s.proxy.$forceUpdate(),u.bookings=[],u.name=""});const c=()=>i.findAccount("Bussi","Kilometer").saldoY(n.currentPeriod),a=()=>Math.round(K.reduce((o,S)=>o+N(S),0)),y=()=>Math.round(100*a()*2.37/1e3)/100,p=()=>Math.round(a()/c()*1e4)/100,N=o=>q(o)?+o.liters.replace("l","").trim().replace(",","."):0;R("bs after bookEverythingtoBS",i);const I=(o,S,C,z)=>{const d=o.findAccount("Bussi","Konto 1"),_=Ne(-d.saldoY(z.currentPeriod)/C.personen.length);if(_===0)return o;for(var O of C.personen){const k=o.findAccount(O,"Konto 1"),F=new v("9999",z.currentPeriod+"-12-31",_,0,"Ausgleichsbuchung Konto1 "+z.currentPeriod+" "+k.owner+":"+k.name+" -> "+d.owner+":"+d.name);P(F,k,d)}return o},T=(o,S,C,z)=>{const d=o.saldierenEuro("Bussi"),_=C.personen.map(k=>{const F=o.saldierenEuro(k)+d/C.personen.length;return{name:k,saldo:F}});let O=100;for(;O-- >0;){const k=_.reduce((D,$)=>D.saldo<$.saldo?D:$),F=_.reduce((D,$)=>D.saldo>$.saldo?D:$);if(k.saldo>=0||F.saldo<=0)break;const V=Math.min(-k.saldo,F.saldo),j=o.findAccount(F.name,"Ausgleichskonto"),H=o.findAccount(k.name,"Ausgleichskonto"),ce="Ausgleichsbuchung Salden <br>"+z.currentPeriod+" "+j.owner+":"+j.name+" -> "+H.owner+":"+H.name+"<br>Amount: "+ne(V)+"<br>konkret:  "+j.owner+" bekommt "+ne(V)+" von "+H.owner,ae=new v("9999",z.currentPeriod+"-12-31",V,0,ce);P(ae,j,H),k.saldo+=V,F.saldo-=V}return o};return(o,S)=>{const C=Le,z=we;return E(),x("div",null,[b(C),r("h1",null,"Bilanz "+A(l(n).currentPeriod)+", "+A(l(K).length)+" Buchungen ",1),l(i).findAccount("Bussi","Errors").bookings.length>0?(E(),x("div",Me,[r("a",{class:"errors",href:"#",onClick:S[0]||(S[0]=d=>e(l(i).findAccount("Bussi","Errors")))}," Errors: "+A(l(i).findAccount("Bussi","Errors").bookings.length),1)])):ee("",!0),r("div",null,"Kilometer: "+A(c())+" km",1),r("div",null,"Benzin: "+A(a())+" Liter",1),r("div",null,"CO2: "+A(y())+" Tonnen CO2 ",1),r("div",null,"Verbrauch: "+A(p())+" Liter/100km",1),r("div",null,"Reparaturpauschale: "+A(l(n).reparaturpauschale("2022"))+"€",1),Oe,u.bookings.length!=0?(E(),x("div",Re,[r("div",Ge,[r("button",{class:"green",onClick:S[1]||(S[1]=d=>g())},"hit ⌘+<Enter> to go back"),u.bookings.length>0?(E(),x("div",Ie)):ee("",!0),b(z,{selectedBookingsToRender:u.bookings,konto:u.name},null,8,["selectedBookingsToRender","konto"])])])):(E(),x("div",Te,[r("table",null,[(E(!0),x(Q,null,X(l(w),d=>(E(),x("tr",null,[r("td",null,[se(A(d),1),r("a",{href:"#",onClick:_=>e(l(i).findAccount(d,"Kilometer"))},[r("div",null,"Kilometer: "+A(Math.abs(l(i).findAccount(d,"Kilometer").saldoY(l(n).currentPeriod)))+" km",1)],8,Ve),r("div",null,[r("b",null,"Saldo: "+A(l(i).saldierenEuro(d))+" €",1)])]),r("td",null,[r("table",De,[$e,Ye,Ue,je,(E(!0),x(Q,null,X(l(G).accounts.filter(_=>_.Name!=="Kilometer"&&(_.Name!=="Konto 9000"||d==="Bussi")),_=>(E(),x("tr",He,[r("td",We,[r("a",{href:"#",onClick:O=>e(l(i).findAccount(d,_.Name))},[r("span",null,A(_.Bezeichnung),1)],8,Ze),qe]),r("td",Je,A(l(i).findAccount(d,_.Name).saldoY(l(n).currentPeriod)),1),r("td",Qe,A(l(i).findAccount(d,_.Name).saldoSoll(l(n).currentPeriod)),1),r("td",Xe,A(l(i).findAccount(d,_.Name).saldoHaben(l(n).currentPeriod)),1)]))),256))])])]))),256))])])),be,et])}}});const ut=ye(tt,[["__scopeId","data-v-69cff240"]]);export{ut as default};
