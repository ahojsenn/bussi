import{G as b,f as W,w as I,o as P,b as K,i as r,h as Z,x as tt,H as et,u as i,z as nt,F as $,s as Y,t as y,j as G,q as rt,k as st,e as U,v as j,C as ct,D as ot,I as at,a as ut}from"./entry.e295535c.js";import{P as it,U as lt,l as O,_ as dt}from"./url.7dc5068a.js";import{u as mt}from"./stakeholder.916c0a26.js";import{a as v,B as H}from"./types.3d83ab55.js";import{u as ht}from"./hauptbuch.3f06fedf.js";import{u as pt}from"./accounts.03e834cd.js";const ft=e=>new Promise(function(h,a){it.parse(e,{download:!0,header:!0,skipEmptyLines:!0,complete:h,error:a})}),_t="/gviz/tq?tqx=out:csv",yt="&sheet=perioden",At=lt+_t+yt,q=b("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const e=await ft(At);this._perioden=e.data,this._currentPeriod=this._perioden[0].Periode},setPeriod(e){this._currentPeriod=e}},getters:{reparaturpauschale:e=>m=>e._perioden.find(h=>h.Periode===m).Reparaturpauschale,listOfPeriods:e=>e._perioden.map(m=>m.Periode),currentPeriod:e=>e._currentPeriod}}),St={id:"my-global"},vt=W({__name:"YearSwitch",async setup(e){let m,h;const a=q();[m,h]=I(()=>a.loadDataFromGoogle()),await m,h();const t=a.listOfPeriods;let x=a.currentPeriod;const f=()=>{O(`


changeFinancialYear`,x),a.setPeriod(x)};return(A,s)=>(P(),K("form",St,[r("span",null,[Z("Welches Jahr möchtest du sehen?"),tt(r("select",{"onUpdate:modelValue":s[0]||(s[0]=N=>nt(x)?x.value=N:x=N),onChange:s[1]||(s[1]=N=>f())},[(P(!0),K($,null,Y(i(t),N=>(P(),K("option",null,y(N),1))),256))],544),[[et,i(x)]])])]))}}),E=(e,m,h)=>{if(e===null)return;const a=new v(e.nr,e.date,e.soll,e.haben,e.description,e.kmStart),t=new v(e.nr,e.date,e.haben,e.soll,e.description,e.kmStart);m.bookings.push(a),h.bookings.push(t)},Bt=e=>e.key.indexOf("an: ")===0,Et=e=>e.key.indexOf("Jahresbeitrag")===0,T=e=>+(e.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(e.description)>0,_=e=>typeof e=="string"?parseFloat(e.replaceAll(".","").replace("€","").trim().replace(",",".")):Number.isNaN(e)?0:e,wt=e=>T(e)?+e.liters.replace("l","").trim().replace(",","."):0;let V=0,F=0;const Pt=(e,m,h,a)=>{for(var t of m){let f=!1;const A=h.shVerteilung(t.account).split(",");A.length>1;for(var x of A){const s=x.trim();if(!e.findAccount(s,"Konto 1")){O("Error: Konto nicht gefunden: ",s,t);const n=e.findAccount("System","Errors"),o=e.findAccount("System","Errors1"),c="Konto "+s+" nicht gefunden",l=new v(t.nr,t.date,0,_(t.amount),c,+t.km);E(l,n,o),f=!0}if(Et(t)){const n=e.findAccount("Bussi","Konto 1"),o=e.findAccount(s,"Konto 1"),c=_(t.amount)/A.length,l=t.account+" Jahresbeitrag "+t.description+" "+c+" "+t.amount,d=new v(t.nr,t.date,0,c,l,+t.km);E(d,n,o),f=!0}if(Bt(t)){const n=e.findAccount(s,"Ausgleichskonto"),o=e.findAccount(t.key.slice(4),"Ausgleichskonto"),c=_(t.amount)/A.length,l=t.account+" Ausgleichsbuchung an "+t.key.slice(4)+" "+c,d=new v(t.nr,t.date,0,c,l,+t.km-+(t.kmSinceLastEntry||"0"));E(d,n,o),f=!0,O("bookEverythingtoBS: ausgleichbuchung gefunden ",t.key,t.key.slice(4),n,o,d)}if(T(t)&&(_(t.fuelPriceInEuro)&&(V=Math.round(1e3*_(t.fuelPriceInEuro))/1e3),t.consumption&&+t.consumption!=0&&(F=Math.round(100*t.consumption)/100,F<8||F>11))){const n=e.findAccount("System","Errors"),o=e.findAccount("System","Errors1"),c="falscher Verbrauchswert:   "+F+"  Liter/100km<br>"+t.account+" Verbrauch "+t.description+" <br> amount:"+t.amount+" "+_(t.amount)+"<br> kmSinceLastEntry:"+t.kmSinceLastEntry+"<br> splits:"+A+"<br> booking:"+JSON.stringify(t),l=new v(t.nr,t.date,0,_(t.amount),c,+t.km);E(l,n,o)}if((n=>+n.key>0||n.key.indexOf("Reparatur")>-1)(t)){const n=e.findAccount(s,"Konto 3"),o=e.findAccount("Bussi","Konto 3"),c=_(t.amount)/A.length,l=t.account+" Reparatur "+t.description+" "+c+" "+t.amount,d=new v(t.nr,t.date,0,c,l,+t.km-+(t.kmSinceLastEntry||"0"));E(d,n,o),f=!0}if((n=>parseFloat(n.kmSinceLastEntry+"")!=0)(t)){const n=e.findAccount(s,"Kilometer"),o=e.findAccount("Bussi","Kilometer"),c=parseFloat(t.kmSinceLastEntry||"0")/A.length,d=+t.km-parseFloat(t.kmSinceLastEntry||"0"),C=Math.round(V*c*F)/100,u=Math.round(100*+a.reparaturpauschale(a.currentPeriod).replace(",",".")*c)/100,S=t.account+" Kilometer "+c+" von "+t.kmSinceLastEntry+" km, "+s+"-->Bussi "+t.description+"<br>Benzingeld: "+C+" €, Reparaturgeld: "+u+" € für "+c+" km",R=new v(t.nr,t.date,c,0,S,d);E(R,n,o),f=!0;const D=e.findAccount(s,"Konto 2"),B=e.findAccount("Bussi","Konto 2"),w="Benzingeld: "+s+"-->Bussi, "+C+" € für "+c+" km, Benzinpreis: "+V+"€/L, Verbrauch: "+F+" ="+Math.round(V*F)/100+"€/km",J=new v(t.nr,t.date,C,0,w,d);E(J,D,B);const g=e.findAccount("Bussi","Konto 3"),Q=e.findAccount(s,"Konto 3"),X=new v(t.nr,t.date,0,u,"Reparaturpauschale "+a.reparaturpauschale(a.currentPeriod)+" €/km * "+c+" km = "+u+" € : "+s+" --> Bussi",d);E(X,g,Q)}if(T(t)){const n=Math.round(100*_(t.amount))/100,o=e.findAccount("Bussi","Konto 2"),c=e.findAccount(s,"Konto 2"),l=t.account+": Tanken für "+n+"€, "+wt(t)+" Liter, <br> Verbrauch: "+F+" l/100km, <br>"+s+"-->Bussi<br>Benzinpreis: "+V+" €/l",d=_(t.amount)/A.length,u=+t.km-parseFloat(t.kmSinceLastEntry||"0"),S=new v(t.nr,t.date,d,0,l,u);E(S,o,c),f=!0}if((n=>n.key==="gleich")(t)){const n=e.findAccount(s,"Konto 1"),o=e.findAccount("Bussi","Konto 1"),c=_(t.amount)/A.length,l=t.account+" Konto 1 "+t.description+" "+c+" "+t.amount,d=new v(t.nr,t.date,0,c,l,+t.km);E(d,n,o),f=!0}const z=n=>{const o=t&&t.key&&typeof t.key=="string"&&t.key.split(" ").length>0?t.key.split(" ")[1]:"";return n.key.split(" ")[0]==="an"&&o!==""&&(o==="Bussi"||h.personen.indexOf(o)>=0)};if(z(t)){const n=e.findAccount(s,"Ausgleichskonto"),o=t.key.split(" ")[1],c=e.findAccount(o,"Ausgleichskonto"),l=t.account+"-->"+o+": "+t.description+" "+_(t.amount)+" "+t.amount,d=new v(t.nr,t.date,0,_(t.amount),l,+t.km);E(d,n,c),f=!0}if((n=>n.key.toLowerCase()==="jahresendbuchung")(t)){const n=t.description.match("[A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]* -> [A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]*"),o=n?n[0]:"";if(o==="")return e;const c=o.split(" -> ")[0].split(":")[0],l=o.split(" -> ")[1].split(":")[0],d=o.split(" -> ")[0].split(":")[1],C=o.split(" -> ")[1].split(":")[1],u=e.findAccount(c,d),S=e.findAccount(l,C),R=new v(t.nr,t.date,_(t.amount),0,t.description,+t.km);E(R,u,S),f=!0}if(_(t.amount)===0&&+(t.kmSinceLastEntry||"0")==0&&(f=!0,O("Nullbuchung ignoriert: "+t+"  km:"+t.kmSinceLastEntry+" €:"+t.amount)),!f){O("Fehler: ",t,z(t));const n=e.findAccount("System","Errors"),o=e.findAccount("System","Errors1"),c=t.account+" Konto 1 "+t.description+" <br> amount:"+t.amount+" "+_(t.amount)+"<br> kmSinceLastEntry:"+t.kmSinceLastEntry+"<br> splits:"+A+"<br> booking:"+JSON.stringify(t),l=new v(t.nr,t.date,0,_(t.amount),c,+t.km);E(l,n,o)}}}return e},L=e=>(ct("data-v-5b1793db"),e=e(),ot(),e),Kt={key:0},xt=L(()=>r("div",null," ",-1)),Lt={key:1},Nt={class:"center"},zt=L(()=>r("br",null,null,-1)),Ct=L(()=>r("br",null,null,-1)),Ft={key:0},Ot={key:2},Mt=["onClick"],Rt={class:"inner",style:{width:"100%"}},Vt=L(()=>r("th",{class:"inner"},"Kontobezeichnung ",-1)),Gt=L(()=>r("th",{class:"innter"},"#Buchungen",-1)),It=L(()=>r("th",{class:"inner"},"Saldo ",-1)),Tt=L(()=>r("th",{class:"inner grey"},"Soll",-1)),kt=L(()=>r("th",{class:"inner grey"},"Haben",-1)),Dt={class:"inner"},$t={class:"inner"},Yt=["onClick"],Jt=L(()=>r("span",null,"     ",-1)),Ut={class:"inner"},jt={class:"inner"},Ht={class:"inner grey"},Wt={class:"inner grey"},Zt=L(()=>r("br",null,null,-1)),qt=L(()=>r("br",null,null,-1)),gt=W({__name:"balance",async setup(e){let m,h;const a=G({bookings:[],name:""}),t=u=>{const S=u.bookings;a.bookings.splice(0,a.bookings.length),a.bookings.push(...S),a.name=u.owner+" "+u.name},x=()=>{a.bookings=[],a.name=""};rt(()=>{window.addEventListener("keydown",u=>{u.key==="Enter"&&u.metaKey&&x()})});const f=mt();[m,h]=I(()=>f.loadStakeholder()),await m,h();const A=f.stakeholder.filter(u=>u.Verteilung.indexOf(",")===-1).map(u=>u.Verteilung),s=q();[m,h]=I(()=>s.loadDataFromGoogle()),await m,h(),O("balance.currentPeriod ",s.currentPeriod,s);const N=ht(),M=pt();[m,h]=I(()=>M.loadDataFromGoogle()),await m,h(),M.accountBezeichnungen;const k=M.accountNames;let z=G(N.bookings),p=G(new H(A,k,z));p.findAccount("System","Errors");const n=at();st(s.$state,async(u,S)=>{await N.loadBussiData(s.currentPeriod),z=G(N.bookings),p=new H(A,k,z),p=Pt(p,z,f,s),n&&n.proxy&&n.proxy.$forceUpdate(),a.bookings=[],a.name=""});const o=()=>p.findAccount("Bussi","Kilometer").saldoY(s.currentPeriod),c=()=>Math.round(z.reduce((u,S)=>u+C(S),0)),l=()=>Math.round(100*c()*2.37/1e3)/100,d=()=>Math.round(c()/o()*1e4)/100,C=u=>T(u)?+u.liters.replace("l","").trim().replace(",","."):0;return O("bs after bookEverythingtoBS",p),(u,S)=>{const R=vt,D=dt;return P(),K("div",null,[U(R),r("h1",null,"Bilanz: "+y(i(s).currentPeriod)+", "+y(i(z).length)+" Buchungen ",1),i(p).findAccount("Bussi","Errors").bookings.length>0?(P(),K("div",Kt,[r("a",{class:"errors",href:"#",onClick:S[0]||(S[0]=B=>t(i(p).findAccount("Bussi","Errors")))}," Errors: "+y(i(p).findAccount("Bussi","Errors").bookings.length),1)])):j("",!0),r("div",null,"Kilometer: "+y(o())+" km",1),r("div",null,"Benzin: "+y(c())+" Liter",1),r("div",null,"CO2: "+y(l())+" Tonnen CO2 ",1),r("div",null,"Verbrauch: "+y(d())+" Liter/100km",1),r("div",null,"Reparaturpauschale: "+y(i(s).reparaturpauschale(i(s).currentPeriod))+"€",1),xt,a.bookings.length!=0?(P(),K("div",Lt,[r("div",Nt,[r("button",{class:"green",onClick:S[1]||(S[1]=B=>x())},"hit ⌘+<Enter> to go back to the table"),zt,Ct,a.bookings.length>0?(P(),K("div",Ft)):j("",!0),U(D,{selectedBookingsToRender:a.bookings,konto:a.name},null,8,["selectedBookingsToRender","konto"])])])):(P(),K("div",Ot,[r("table",null,[(P(!0),K($,null,Y(i(A),B=>(P(),K("tr",null,[r("td",null,[Z(y(B),1),r("a",{href:"#",onClick:w=>t(i(p).findAccount(B,"Kilometer"))},[r("div",null,"Kilometer: "+y(Math.abs(i(p).findAccount(B,"Kilometer").saldoY(i(s).currentPeriod)))+" km",1)],8,Mt),r("div",null,[r("b",null,"Saldo: "+y(i(p).saldierenEuro(B))+" €",1)])]),r("td",null,[r("table",Rt,[Vt,Gt,It,Tt,kt,(P(!0),K($,null,Y(i(M).accounts.filter(w=>w.Name!=="Kilometer"&&(w.Name!=="Konto 9000"||B==="Bussi")),w=>(P(),K("tr",Dt,[r("td",$t,[r("a",{href:"#",onClick:J=>t(i(p).findAccount(B,w.Name))},[r("span",null,y(w.Bezeichnung),1)],8,Yt),Jt]),r("td",Ut,y(i(p).findAccount(B,w.Name).bookings.length),1),r("td",jt,y(i(p).findAccount(B,w.Name).saldoY(i(s).currentPeriod))+" €",1),r("td",Ht,y(i(p).findAccount(B,w.Name).saldoSoll(i(s).currentPeriod))+" €",1),r("td",Wt,y(i(p).findAccount(B,w.Name).saldoHaben(i(s).currentPeriod))+" € ",1)]))),256))])])]))),256))])])),Zt,qt])}}});const re=ut(gt,[["__scopeId","data-v-5b1793db"]]);export{re as default};
