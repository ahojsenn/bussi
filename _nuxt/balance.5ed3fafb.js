import{G as Z,f as J,w as M,o as S,b as v,i as r,h as j,x as b,H as ee,u as i,z as te,F as $,s as U,t as m,j as C,q as ne,k as re,e as H,v as W,C as se,D as oe,I as ce,a as ae}from"./entry.a81d83fd.js";import{P as ie,l as O,_ as le}from"./papaparse.min.3750104f.js";import{U as ue,u as de}from"./hauptbuch.069fd21c.js";import{u as me}from"./stakeholder.a3eaf81d.js";import{a as E,B as q}from"./types.9c14c63d.js";import{u as pe}from"./accounts.64e36102.js";const he=t=>new Promise(function(d,o){ie.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:d,error:o})}),fe="/gviz/tq?tqx=out:csv",_e="&sheet=perioden",ye=ue+fe+_e,Q=Z("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const t=await he(ye);this._perioden=t.data,this._currentPeriod=this._perioden[0].Periode},setPeriod(t){this._currentPeriod=t}},getters:{reparaturpauschale:t=>l=>t._perioden.find(d=>d.Periode===l).Reparaturpauschale,listOfPeriods:t=>t._perioden.map(l=>l.Periode),currentPeriod:t=>t._currentPeriod}}),Se={id:"my-global"},ve=J({__name:"YearSwitch",async setup(t){let l,d;const o=Q();[l,d]=M(()=>o.loadDataFromGoogle()),await l,d();const e=o.listOfPeriods;let B=o.currentPeriod;const p=()=>{o.setPeriod(B)};return(_,s)=>(S(),v("form",Se,[r("span",null,[j("Welches Jahr möchtest du sehen?"),b(r("select",{"onUpdate:modelValue":s[0]||(s[0]=w=>te(B)?B.value=w:B=w),onChange:s[1]||(s[1]=w=>p())},[(S(!0),v($,null,U(i(e),w=>(S(),v("option",null,m(w),1))),256))],544),[[ee,i(B)]])])]))}}),x=(t,l,d)=>{if(t===null)return;const o=new E(t.nr,t.date,t.soll,t.haben,t.description,t.kmStart),e=new E(t.nr,t.date,t.haben,t.soll,t.description,t.kmStart);l.bookings.push(o),d.bookings.push(e)},X=t=>+(t.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(t.description)>0,K=t=>typeof t=="string"?parseFloat(t.replaceAll(".","").replace("€","").trim().replace(",",".")):Number.isNaN(t)?0:t,D=t=>X(t)?+t.liters.replace("l","").trim().replace(",","."):0,Ae=(t,l)=>Math.round(100*100*t/l)/100,Be=t=>parseFloat(t.kmSinceLastFuelFill||"0");let N=0,z=0;const we=(t,l,d,o)=>{O("bookEverythingtoBS: ",o.currentPeriod);for(var e of l){let p=!1;const _=d.shVerteilung(e.account).split(",");_.length>1;for(var B of _){const s=B.trim();if((n=>+n.key>0||n.key.indexOf("Reparatur")>-1)(e)){const n=t.findAccount(s,"Konto 3"),u=t.findAccount("Bussi","Konto 3"),c=K(e.amount)/_.length,h=e.account+" Reparatur "+e.description+" "+c+" "+e.amount,f=new E(e.nr,e.date,0,c,h,+e.km-+(e.kmSinceLastEntry||"0"));x(f,n,u),p=!0}if(X(e)){const n=Math.round(100*K(e.amount))/100;N=Math.round(1e3*n/D(e))/1e3,z=Ae(D(e),Be(e));const u=t.findAccount("Bussi","Konto 2"),c=t.findAccount(s,"Konto 2"),h=e.account+": Tanken für "+n+"€, "+D(e)+" Liter, <br> Verbrauch: "+z+" l/100km, <br>"+s+"-->Bussi<br>Benzinpreis: "+N+" €/l",f=K(e.amount)/_.length,L=new E(e.nr,e.date,f,0,h);x(L,u,c),p=!0}if((n=>parseFloat(n.kmSinceLastEntry+"")!=0)(e)){const n=t.findAccount(s,"Kilometer"),u=t.findAccount("Bussi","Kilometer"),c=parseFloat(e.kmSinceLastEntry||"0")/_.length;+e.km-parseFloat(e.kmSinceLastEntry||"0");const f=Math.round(N*c*z)/100,L=Math.round(100*+o.reparaturpauschale(o.currentPeriod).replace(",",".")*c)/100,T=e.account+" Kilometer "+c+" von "+e.kmSinceLastEntry+" km, "+s+"-->Bussi "+e.description+"<br>Benzingeld: "+f+" €, Reparaturgeld: "+L+" € für "+c+" km",G=new E(e.nr,e.date,c,0,T);x(G,n,u),p=!0;const a=t.findAccount(s,"Konto 2"),A=t.findAccount("Bussi","Konto 2"),V="Benzingeld: "+f+" € für "+c+" km, Benzinpreis: "+N+"€/L, Verbrauch: "+z+" ergibt: "+Math.round(N*z)/100+" €/km",I=new E(e.nr,e.date,f,0,V);x(I,a,A);const y=t.findAccount("Bussi","Konto 3"),k=t.findAccount(s,"Konto 3"),Y=new E(e.nr,e.date,0,L,"Reparaturpauschale "+o.reparaturpauschale(o.currentPeriod)+" €/km * "+c+" km = "+L+" € : "+s+" --> Bussi");x(Y,y,k)}if((n=>n.key==="gleich")(e)){const n=t.findAccount(s,"Konto 1"),u=t.findAccount("Bussi","Konto 1"),c=K(e.amount)/_.length,h=e.account+" Konto 1 "+e.description+" "+c+" "+e.amount,f=new E(e.nr,e.date,0,c,h,+e.km);x(f,n,u),p=!0}const P=n=>{const u=e&&e.key&&typeof e.key=="string"&&e.key.split(" ").length>0?e.key.split(" ")[1]:"";return n.key.split(" ")[0]==="an"&&u!==""&&(u==="Bussi"||d.personen.indexOf(u)>=0)};if(P(e)){const n=t.findAccount(s,"Ausgleichskonto"),u=e.key.split(" ")[1],c=t.findAccount(u,"Ausgleichskonto"),h=e.account+"-->"+u+": "+e.description+" "+K(e.amount)+" "+e.amount,f=new E(e.nr,e.date,0,K(e.amount),h,+e.km);x(f,n,c),p=!0}if(K(e.amount)===0&&+(e.kmSinceLastEntry||"0")==0&&(p=!0,O("Nullbuchung ignoriert: ",e.km,e.nr,e.kmSinceLastEntry)),!p){O("Fehler: ",e,P(e));const n=t.findAccount("System","Errors"),u=t.findAccount("System","Errors1"),c=e.account+" Konto 1 "+e.description+" <br> amount:"+e.amount+" "+K(e.amount)+"<br> kmSinceLastEntry:"+e.kmSinceLastEntry+"<br> splits:"+_+"<br> booking:"+JSON.stringify(e),h=new E(e.nr,e.date,0,K(e.amount),c,+e.km);x(h,n,u)}}}return t},F=t=>(se("data-v-738946f1"),t=t(),oe(),t),Pe={key:0},ke=F(()=>r("div",null," ",-1)),Ee={key:1},Ke={class:"center"},xe={key:0},Fe={key:2},Le=["onClick"],ge={class:"inner",style:{width:"100%"}},Ne=F(()=>r("th",{class:"inner"},"Kontobezeichnung ",-1)),ze=F(()=>r("th",{class:"inner"},"Saldo ",-1)),Ce=F(()=>r("th",{class:"inner grey"},"Soll",-1)),Me=F(()=>r("th",{class:"inner grey"},"Haben",-1)),Oe={class:"inner"},Re={class:"inner"},Te=["onClick"],Ge=F(()=>r("span",null,"     ",-1)),Ve={class:"inner"},Ie={class:"inner grey"},De={class:"inner grey"},$e=F(()=>r("br",null,null,-1)),Ue=F(()=>r("br",null,null,-1)),Ye=J({__name:"balance",async setup(t){let l,d;const o=C({bookings:[],name:""}),e=a=>{const A=a.bookings;o.bookings.splice(0,o.bookings.length),o.bookings.push(...A),o.name=a.owner+" "+a.name},B=()=>{o.bookings=[],o.name=""};ne(()=>{window.addEventListener("keydown",a=>{a.key==="Enter"&&a.metaKey&&B()})});const p=me();[l,d]=M(()=>p.loadStakeholder()),await l,d();const _=p.stakeholder.filter(a=>a.Verteilung.indexOf(",")===-1).map(a=>a.Verteilung),s=Q();[l,d]=M(()=>s.loadDataFromGoogle()),await l,d(),O("balance.currentPeriod ",s.currentPeriod,s);const w=de(),g=pe();[l,d]=M(()=>g.loadDataFromGoogle()),await l,d(),g.accountBezeichnungen;const R=g.accountNames;let P=C(w.bookings),n=C(new q(_,R,P));n.findAccount("System","Errors");const u=ce();re(s.$state,async(a,A)=>{await w.loadBussiData(s.currentPeriod),P=C(w.bookings),n=new q(_,R,P),n=we(n,P,p,s),n=balanceKonto1(n,P,p,s),u&&u.proxy&&u.proxy.$forceUpdate(),o.bookings=[],o.name=""});const c=()=>n.findAccount("Bussi","Kilometer").saldoY(s.currentPeriod),h=()=>Math.round(P.reduce((a,A)=>a+T(A),0)),f=()=>Math.round(100*h()*2.37/1e3)/100,L=()=>Math.round(h()/c()*1e4)/100,T=a=>G(a)?+a.liters.replace("l","").trim().replace(",","."):0,G=a=>+(a.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(a.description)>0;return(a,A)=>{const V=ve,I=le;return S(),v("div",null,[H(V),r("h1",null,"Bilanz "+m(i(s).currentPeriod)+", "+m(i(P).length)+" Buchungen ",1),i(n).findAccount("Bussi","Errors").bookings.length>0?(S(),v("div",Pe,[r("a",{class:"errors",href:"#",onClick:A[0]||(A[0]=y=>e(i(n).findAccount("Bussi","Errors")))}," Errors: "+m(i(n).findAccount("Bussi","Errors").bookings.length),1)])):W("",!0),r("div",null,"Kilometer: "+m(c())+" km",1),r("div",null,"Benzin: "+m(h())+" Liter",1),r("div",null,"CO2: "+m(f())+" Tonnen CO2 ",1),r("div",null,"Verbrauch: "+m(L())+" Liter/100km",1),r("div",null,"Reparaturpauschale: "+m(i(s).reparaturpauschale("2022"))+"€",1),ke,o.bookings.length!=0?(S(),v("div",Ee,[r("div",Ke,[r("button",{class:"green",onClick:A[1]||(A[1]=y=>B())},"hit ⌘+<Enter> to go back"),o.bookings.length>0?(S(),v("div",xe)):W("",!0),H(I,{selectedBookingsToRender:o.bookings,konto:o.name},null,8,["selectedBookingsToRender","konto"])])])):(S(),v("div",Fe,[r("table",null,[(S(!0),v($,null,U(i(_),y=>(S(),v("tr",null,[r("td",null,[j(m(y),1),r("a",{href:"#",onClick:k=>e(i(n).findAccount(y,"Kilometer"))},[r("div",null,"Kilometer: "+m(Math.abs(i(n).findAccount(y,"Kilometer").saldoY(i(s).currentPeriod)))+" km",1)],8,Le),r("div",null,[r("b",null,"Saldo: "+m(i(n).saldierenEuro(y))+" €",1)])]),r("td",null,[r("table",ge,[Ne,ze,Ce,Me,(S(!0),v($,null,U(i(g).accounts.filter(k=>k.Name!=="Kilometer"),k=>(S(),v("tr",Oe,[r("td",Re,[r("a",{href:"#",onClick:Y=>e(i(n).findAccount(y,k.Name))},[r("span",null,m(k.Bezeichnung),1)],8,Te),Ge]),r("td",Ve,m(i(n).findAccount(y,k.Name).saldoY(i(s).currentPeriod)),1),r("td",Ie,m(i(n).findAccount(y,k.Name).saldoSoll(i(s).currentPeriod)),1),r("td",De,m(i(n).findAccount(y,k.Name).saldoHaben(i(s).currentPeriod)),1)]))),256))])])]))),256))])])),$e,Ue])}}});const Xe=ae(Ye,[["__scopeId","data-v-738946f1"]]);export{Xe as default};
