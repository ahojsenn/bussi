import{E as re,a as Z,w as T,o as _,b as v,h as r,e as b,s as oe,G as se,u as d,x as ae,F as U,p as W,t as p,r as C,l as ce,m as ie,f as j,q as Q,B as ue,C as le,H as de,D as me}from"./entry.7d03f9f3.js";import{P as pe,l as q,_ as he}from"./papaparse.min.8daad6db.js";import{U as fe,u as _e}from"./hauptbuch.4d0fb974.js";import{u as ve}from"./stakeholder.ebb47caf.js";import{a as B,A as ye,B as X}from"./types.7b198488.js";import{u as Se}from"./accounts.52571bcc.js";import"./config.4eefdab9.js";const we=t=>new Promise(function(l,m){pe.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:l,error:m})}),Be="/gviz/tq?tqx=out:csv",ke="&sheet=perioden",Pe=fe+Be+ke,ee=re("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const t=await we(Pe);this._perioden=t.data,this._currentPeriod=this._perioden[t.data.length-2].Periode},setPeriod(t){this._currentPeriod=t}},getters:{reparaturpauschale:t=>a=>t._perioden.find(l=>l.Periode===a).Reparaturpauschale,listOfPeriods:t=>t._perioden.map(a=>a.Periode),currentPeriod:t=>t._currentPeriod}}),Ae={id:"my-global"},ge=Z({__name:"YearSwitch",async setup(t){let a,l;const m=ee();[a,l]=T(()=>m.loadDataFromGoogle()),await a,l();const e=m.listOfPeriods;let y=m.currentPeriod;const S=()=>{m.setPeriod(y)};return(w,u)=>(_(),v("form",Ae,[r("span",null,[b("Welches Jahr möchtest du sehen?"),oe(r("select",{"onUpdate:modelValue":u[0]||(u[0]=c=>ae(y)?y.value=c:y=c),onChange:u[1]||(u[1]=c=>S())},[(_(!0),v(U,null,W(d(e),c=>(_(),v("option",null,p(c),1))),256))],544),[[se,d(y)]])])]))}}),E=(t,a,l)=>{if(t===null)return;const m=new B(t.nr,t.date,t.soll,t.haben,t.description,t.kmStart,t.kmEnde,t.abschreibedauer),e=new B(t.nr,t.date,t.haben,t.soll,t.description,t.kmStart,t.kmEnde,t.abschreibedauer);a.bookings.push(m),l.bookings.push(e)},te=t=>+t.kmSinceLastFuelFill!=0||"Tanken".indexOf(t.description)>0,k=t=>typeof t=="string"?parseFloat(t.replace("€","").trim().replace(",",".")):Number.isNaN(t)?0:t,Y=t=>te(t)?+t.liters.replace("l","").trim().replace(",","."):0,Ee=(t,a)=>Math.round(100*100*t/a)/100,Ke=t=>parseFloat(t.kmSinceLastFuelFill);let R=0,O=0;const xe=(t,a,l,m)=>{q("bookEverythingtoBS: ",m.currentPeriod);for(var e of a){let S=!1;const w=l.shVerteilung(e.account).split(",");w.length>1;for(var y of w){const u=y.trim();if((o=>+o.key>0)(e)){const o=t.findAccount(u,"Konto 3"),s=t.findAccount("Bussi","Konto 3"),i=e.account+" Reparatur "+e.description+" "+k(e.amount)+" "+e.amount,P=new B(e.nr,e.date,0,k(e.amount),i,+e.km-+e.kmSinceLastEntry);E(P,o,s),S=!0}if(te(e)){R=Math.round(1e3*k(e.amount)/Y(e))/1e3,O=Ee(Y(e),Ke(e));const o=t.findAccount("Bussi","Konto 2"),s=t.findAccount(u,"Konto 2"),i=e.account+" Tanken "+Y(e)+" Liter, <br> Verbrauch: "+O+" l/100km, <br>"+u+"-->Bussi<br>Benzinpreis: "+R+" €/l",P=k(e.amount)/w.length,A=new B(e.nr,e.date,P,0,i);E(A,o,s),S=!0}if((o=>parseFloat(o.kmSinceLastEntry)!=0)(e)){const o=t.findAccount(u,"Kilometer"),s=t.findAccount("Bussi","Kilometer"),i=parseFloat(e.kmSinceLastEntry)/w.length;+e.km-parseFloat(e.kmSinceLastEntry);const A=Math.round(R*i*O)/100,K=Math.round(100*+m.reparaturpauschale(m.currentPeriod).replace(",",".")*i)/100,G=e.account+" Kilometer "+i+" von "+e.kmSinceLastEntry+" km, "+u+"-->Bussi "+e.description+"<br>Benzingeld: "+A+" €, Reparaturgeld: "+K+" € für "+i+" km",M=new B(e.nr,e.date,i,0,G);E(M,o,s),S=!0;const V=t.findAccount(u,"Ausgleichskonto"),D=t.findAccount("Bussi","Konto 2"),I="Benzingeld: "+A+" € für "+i+" kmBenzinpreis = "+Math.round(R*O)/100+" €/km",n=new B(e.nr,e.date,A,0,I);E(n,V,D);const f=t.findAccount("Bussi","Konto 3"),F=t.findAccount(u,"Ausgleichskonto"),x=new B(e.nr,e.date,0,K,"Reparaturkosten aus Kilometern von "+m.reparaturpauschale(m.currentPeriod)+" €/km<br> Reparaturpauschale: "+K+" € für "+i+" km<br> "+u+" --> Bussi");E(x,f,F)}if((o=>o.key==="gleich")(e)){const o=t.findAccount(u,"Konto 1"),s=t.findAccount("Bussi","Konto 1"),i=e.account+" Konto 1 "+e.description+" "+k(e.amount)+" "+e.amount,P=new B(e.nr,e.date,0,k(e.amount),i,+e.km);E(P,o,s),S=!0}k(e.amount)===0&&+e.kmSinceLastEntry==0&&(S=!0);const z=new ye("Nullkonto","Errors");if(!S){const o=t.findAccount("System","Errors"),s=e.account+" Konto 1 "+e.description+" <br> amount:"+e.amount+" "+k(e.amount)+"<br> kmSinceLastEntry:"+e.kmSinceLastEntry+"<br> splits:"+w+"<br> booking:"+JSON.stringify(e),i=new B(e.nr,e.date,0,k(e.amount),s,+e.km);E(i,o,z)}}}return t},H=t=>(ue("data-v-ab7c4a96"),t=t(),le(),t),Fe={key:0},Le=H(()=>r("div",null," ",-1)),Ne={key:1},ze={class:"center"},Ce={key:0},Re={key:2},Oe=["onClick"],Te={class:"inner",style:{width:"100%"}},Ge=H(()=>r("th",{class:"inner z100z"},"Kontobezeichnung ",-1)),Me=H(()=>r("th",{class:"inner",style:{width:"25%"}},"Saldo ",-1)),Ve={class:"inner"},De={class:"inner"},Ie=["onClick"],$e={class:"inner"},Ye=Z({__name:"balance",async setup(t){let a,l;const m=n=>n.length>60?n.substr(0,60)+"...":n,e=C({bookings:[],name:""}),y=n=>{const f=n.bookings;e.bookings.splice(0,e.bookings.length),e.bookings.push(...f),e.name=n.owner+" "+n.name},S=()=>{e.bookings=[],e.name=""};ce(()=>{window.addEventListener("keydown",n=>{n.key==="Enter"&&n.metaKey&&S()})});const w=ve();[a,l]=T(()=>w.loadStakeholder()),await a,l();const u=w.stakeholder.filter(n=>n.Verteilung.indexOf(",")===-1).map(n=>n.Verteilung),c=ee();[a,l]=T(()=>c.loadDataFromGoogle()),await a,l(),q("balance.currentPeriod ",c.currentPeriod,c);const N=_e(),L=Se();[a,l]=T(()=>L.loadDataFromGoogle()),await a,l(),L.accountBezeichnungen;const z=L.accountNames;let o=C(N.bookings),s=C(new X(u,z,o));const i=s.findAccount("Bussi","Errors"),P=de();ie(c.$state,async(n,f)=>{await N.loadBussiData(c.currentPeriod),o=C(N.bookings),s=new X(u,z,o),s=xe(s,o,w,c),s=I(s,o,w,c),P.proxy.$forceUpdate()});const A=()=>s.findAccount("Bussi","Kilometer").saldoY(c.currentPeriod),K=()=>Math.round(o.reduce((n,f)=>n+V(f),0)),G=()=>Math.round(100*K()*2.37/1e3)/100,M=()=>Math.round(K()/A()*1e4)/100,V=n=>D(n)?+n.liters.replace("l","").trim().replace(",","."):0,D=n=>+n.kmSinceLastFuelFill!=0||"Tanken".indexOf(n.description)>0;q("bs after bookEverythingtoBS",s);const I=(n,f,F,x)=>{const h=n.findAccount("Bussi","Konto 1"),g=h.saldoY(x.currentPeriod)/F.personen.length;for(var J of F.personen){const $=n.findAccount(J,"Ausgleichskonto"),ne=new B("9999",x.currentPeriod+"-12-31",g,0,"Ausgleichsbuchung Konto1 "+x.currentPeriod+" "+h.owner+":"+h.name+" -> "+$.owner+":"+$.name);E(ne,h,$)}return n};return(n,f)=>{const F=ge,x=he;return _(),v("div",null,[j(F),r("h1",null,"Bilanz "+p(d(c).currentPeriod)+", "+p(d(o).length)+" Buchungen",1),d(i).bookings.length>0?(_(),v("div",Fe,[r("a",{class:"errors",href:"#",onClick:f[0]||(f[0]=h=>y(d(i)))}," Errors: "+p(d(i).bookings.length),1)])):Q("",!0),r("div",null,"Kilometer: "+p(A())+" km",1),r("div",null,"Benzin: "+p(K())+" Liter",1),r("div",null,"CO2: "+p(G())+" Tonnen CO2 ",1),r("div",null,"Verbrauch: "+p(M())+" Liter/100km",1),r("div",null,"Reparaturpauschale: "+p(d(c).reparaturpauschale("2022"))+"€",1),Le,e.bookings.length!=0?(_(),v("div",Ne,[r("div",ze,[r("button",{class:"green",onClick:f[1]||(f[1]=h=>S())},"hit ⌘+<Enter> to go back"),e.bookings.length>0?(_(),v("div",Ce)):Q("",!0),j(x,{selectedBookingsToRender:e.bookings,konto:e.name},null,8,["selectedBookingsToRender","konto"])])])):(_(),v("div",Re,[r("table",null,[(_(!0),v(U,null,W(d(u),h=>(_(),v("tr",null,[r("td",null,[b(p(h),1),r("a",{href:"#",onClick:g=>y(d(s).findAccount(h,"Kilometer"))},[r("div",null,"Kilometer: "+p(d(s).findAccount(h,"Kilometer").saldoY(d(c).currentPeriod))+" km",1),r("div",null,"Saldo: "+p(d(s).saldierenEuro(h))+" €",1)],8,Oe)]),r("td",null,[r("table",Te,[Ge,Me,(_(!0),v(U,null,W(d(L).accounts.filter(g=>g.Name!=="Kilometer"),g=>(_(),v("tr",Ve,[r("td",De,[r("a",{href:"#",onClick:J=>y(d(s).findAccount(h,g.Name))},[r("span",null,p(m(g.Bezeichnung)),1)],8,Ie)]),r("td",$e,p(d(s).findAccount(h,g.Name).saldoY(d(c).currentPeriod)),1)]))),256))])])]))),256))])]))])}}});const Xe=me(Ye,[["__scopeId","data-v-ab7c4a96"]]);export{Xe as default};
