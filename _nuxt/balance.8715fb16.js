import{G as te,f as Q,w as G,o as A,b as B,i as r,h as X,x as ne,H as re,u as i,z as se,F as U,s as H,t as p,j as T,p as oe,q as ce,e as q,v as J,D as ae,E as ie,I as le,a as ue}from"./entry.c67d78e3.js";import{P as de,l as O,_ as me}from"./papaparse.min.96047ca9.js";import{U as pe,u as he}from"./hauptbuch.a30b470d.js";import{u as fe}from"./stakeholder.cdc96c04.js";import{a as w,B as j}from"./types.9c14c63d.js";import{u as _e}from"./accounts.236391cf.js";import"./config.946f49aa.js";const ye=t=>new Promise(function(d,o){de.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:d,error:o})}),ve="/gviz/tq?tqx=out:csv",Se="&sheet=perioden",Ae=pe+ve+Se,Z=te("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const t=await ye(Ae);this._perioden=t.data,this._currentPeriod=this._perioden[0].Periode},setPeriod(t){this._currentPeriod=t}},getters:{reparaturpauschale:t=>l=>t._perioden.find(d=>d.Periode===l).Reparaturpauschale,listOfPeriods:t=>t._perioden.map(l=>l.Periode),currentPeriod:t=>t._currentPeriod}}),Be={id:"my-global"},we=Q({__name:"YearSwitch",async setup(t){let l,d;const o=Z();[l,d]=G(()=>o.loadDataFromGoogle()),await l,d();const e=o.listOfPeriods;let P=o.currentPeriod;const h=()=>{o.setPeriod(P)};return(y,s)=>(A(),B("form",Be,[r("span",null,[X("Welches Jahr möchtest du sehen?"),ne(r("select",{"onUpdate:modelValue":s[0]||(s[0]=K=>se(P)?P.value=K:P=K),onChange:s[1]||(s[1]=K=>h())},[(A(!0),B(U,null,H(i(e),K=>(A(),B("option",null,p(K),1))),256))],544),[[re,i(P)]])])]))}}),g=(t,l,d)=>{if(t===null)return;const o=new w(t.nr,t.date,t.soll,t.haben,t.description,t.kmStart),e=new w(t.nr,t.date,t.haben,t.soll,t.description,t.kmStart);l.bookings.push(o),d.bookings.push(e)},b=t=>+(t.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(t.description)>0,E=t=>typeof t=="string"?parseFloat(t.replaceAll(".","").replace("€","").trim().replace(",",".")):Number.isNaN(t)?0:t,Y=t=>b(t)?+t.liters.replace("l","").trim().replace(",","."):0,Pe=(t,l)=>Math.round(100*100*t/l)/100,Ke=t=>parseFloat(t.kmSinceLastFuelFill||"0");let C=0,M=0;const ke=(t,l,d,o)=>{O("bookEverythingtoBS: ",o.currentPeriod);for(var e of l){let h=!1;const y=d.shVerteilung(e.account).split(",");y.length>1;for(var P of y){const s=P.trim();if((n=>+n.key>0)(e)){const n=t.findAccount(s,"Konto 3"),u=t.findAccount("Bussi","Konto 3"),a=E(e.amount)/y.length,f=e.account+" Reparatur "+e.description+" "+a+" "+e.amount,_=new w(e.nr,e.date,0,a,f,+e.km-+(e.kmSinceLastEntry||"0"));g(_,n,u),h=!0}if(b(e)){const n=Math.round(100*E(e.amount))/100;C=Math.round(1e3*n/Y(e))/1e3,M=Pe(Y(e),Ke(e));const u=t.findAccount("Bussi","Konto 2"),a=t.findAccount(s,"Konto 2"),f=e.account+": Tanken für "+n+"€, "+Y(e)+" Liter, <br> Verbrauch: "+M+" l/100km, <br>"+s+"-->Bussi<br>Benzinpreis: "+C+" €/l",_=E(e.amount)/y.length,F=new w(e.nr,e.date,_,0,f);g(F,u,a),h=!0}if((n=>parseFloat(n.kmSinceLastEntry+"")!=0)(e)){const n=t.findAccount(s,"Kilometer"),u=t.findAccount("Bussi","Kilometer"),a=parseFloat(e.kmSinceLastEntry||"0")/y.length;+e.km-parseFloat(e.kmSinceLastEntry||"0");const _=Math.round(C*a*M)/100,F=Math.round(100*+o.reparaturpauschale(o.currentPeriod).replace(",",".")*a)/100,V=e.account+" Kilometer "+a+" von "+e.kmSinceLastEntry+" km, "+s+"-->Bussi "+e.description+"<br>Benzingeld: "+_+" €, Reparaturgeld: "+F+" € für "+a+" km",I=new w(e.nr,e.date,a,0,V);g(I,n,u),h=!0;const D=t.findAccount(s,"Konto 2"),c=t.findAccount("Bussi","Konto 2"),v="Benzingeld: "+_+" € für "+a+" km, Benzinpreis: "+C+"€/L, Verbrauch: "+M+" ergibt: "+Math.round(C*M)/100+" €/km",N=new w(e.nr,e.date,_,0,v);g(N,D,c);const L=t.findAccount("Bussi","Konto 3"),m=t.findAccount(s,"Konto 3"),S=new w(e.nr,e.date,0,F,"Reparaturpauschale "+o.reparaturpauschale(o.currentPeriod)+" €/km * "+a+" km = "+F+" € : "+s+" --> Bussi");g(S,L,m)}if((n=>n.key==="gleich")(e)){const n=t.findAccount(s,"Konto 1"),u=t.findAccount("Bussi","Konto 1"),a=E(e.amount)/y.length,f=e.account+" Konto 1 "+e.description+" "+a+" "+e.amount,_=new w(e.nr,e.date,0,a,f,+e.km);g(_,n,u),h=!0}const k=n=>{const u=e&&e.key&&typeof e.key=="string"&&e.key.split(" ").length>0?e.key.split(" ")[1]:"";return n.key.split(" ")[0]==="an"&&u!==""&&(u==="Bussi"||d.personen.indexOf(u)>=0)};if(k(e)){const n=t.findAccount(s,"Ausgleichskonto"),u=e.key.split(" ")[1],a=t.findAccount(u,"Ausgleichskonto"),f=e.account+"-->"+u+": "+e.description+" "+E(e.amount)+" "+e.amount,_=new w(e.nr,e.date,0,E(e.amount),f,+e.km);g(_,n,a),h=!0}if(E(e.amount)===0&&+(e.kmSinceLastEntry||"0")==0&&(h=!0,O("Nullbuchung ignoriert: ",e)),!h){O("Fehler: ",e,k(e));const n=t.findAccount("System","Errors"),u=t.findAccount("System","Errors1"),a=e.account+" Konto 1 "+e.description+" <br> amount:"+e.amount+" "+E(e.amount)+"<br> kmSinceLastEntry:"+e.kmSinceLastEntry+"<br> splits:"+y+"<br> booking:"+JSON.stringify(e),f=new w(e.nr,e.date,0,E(e.amount),a,+e.km);g(f,n,u)}}}return t},x=t=>(ae("data-v-7b6d2f89"),t=t(),ie(),t),Ee={key:0},ge=x(()=>r("div",null," ",-1)),xe={key:1},Fe={class:"center"},Le={key:0},Ne={key:2},ze=["onClick"],Ce={class:"inner",style:{width:"100%"}},Me=x(()=>r("th",{class:"inner"},"Kontobezeichnung ",-1)),Oe=x(()=>r("th",{class:"inner"},"Saldo ",-1)),Te=x(()=>r("th",{class:"inner grey"},"Soll",-1)),Ge=x(()=>r("th",{class:"inner grey"},"Haben",-1)),Re={class:"inner"},Ve={class:"inner"},Ie=["onClick"],De=x(()=>r("span",null,"     ",-1)),$e={class:"inner"},Ye={class:"inner grey"},Ue={class:"inner grey"},He=x(()=>r("br",null,null,-1)),We=x(()=>r("br",null,null,-1)),qe=Q({__name:"balance",async setup(t){let l,d;const o=T({bookings:[],name:""}),e=c=>{const v=c.bookings;o.bookings.splice(0,o.bookings.length),o.bookings.push(...v),o.name=c.owner+" "+c.name},P=()=>{o.bookings=[],o.name=""};oe(()=>{window.addEventListener("keydown",c=>{c.key==="Enter"&&c.metaKey&&P()})});const h=fe();[l,d]=G(()=>h.loadStakeholder()),await l,d();const y=h.stakeholder.filter(c=>c.Verteilung.indexOf(",")===-1).map(c=>c.Verteilung),s=Z();[l,d]=G(()=>s.loadDataFromGoogle()),await l,d(),O("balance.currentPeriod ",s.currentPeriod,s);const K=he(),z=_e();[l,d]=G(()=>z.loadDataFromGoogle()),await l,d(),z.accountBezeichnungen;const R=z.accountNames;let k=T(K.bookings),n=T(new j(y,R,k));n.findAccount("System","Errors");const u=le();ce(s.$state,async(c,v)=>{await K.loadBussiData(s.currentPeriod),k=T(K.bookings),n=new j(y,R,k),n=ke(n,k,h,s),n=D(n,k,h,s),u&&u.proxy&&u.proxy.$forceUpdate(),o.bookings=[],o.name=""});const a=()=>n.findAccount("Bussi","Kilometer").saldoY(s.currentPeriod),f=()=>Math.round(k.reduce((c,v)=>c+V(v),0)),_=()=>Math.round(100*f()*2.37/1e3)/100,F=()=>Math.round(f()/a()*1e4)/100,V=c=>I(c)?+c.liters.replace("l","").trim().replace(",","."):0,I=c=>+(c.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(c.description)>0;O("bs after bookEverythingtoBS",n);const D=(c,v,N,L)=>{const m=c.findAccount("Bussi","Konto 1"),S=-m.saldoY(L.currentPeriod)/N.personen.length;for(var W of N.personen){const $=c.findAccount(W,"Konto 1"),ee=new w("9999",L.currentPeriod+"-12-31",0,S,"Ausgleichsbuchung Konto1 "+L.currentPeriod+" "+m.owner+":"+m.name+" -> "+$.owner+":"+$.name);g(ee,m,$)}return c};return(c,v)=>{const N=we,L=me;return A(),B("div",null,[q(N),r("h1",null,"Bilanz "+p(i(s).currentPeriod)+", "+p(i(k).length)+" Buchungen ",1),i(n).findAccount("Bussi","Errors").bookings.length>0?(A(),B("div",Ee,[r("a",{class:"errors",href:"#",onClick:v[0]||(v[0]=m=>e(i(n).findAccount("Bussi","Errors")))}," Errors: "+p(i(n).findAccount("Bussi","Errors").bookings.length),1)])):J("",!0),r("div",null,"Kilometer: "+p(a())+" km",1),r("div",null,"Benzin: "+p(f())+" Liter",1),r("div",null,"CO2: "+p(_())+" Tonnen CO2 ",1),r("div",null,"Verbrauch: "+p(F())+" Liter/100km",1),r("div",null,"Reparaturpauschale: "+p(i(s).reparaturpauschale("2022"))+"€",1),ge,o.bookings.length!=0?(A(),B("div",xe,[r("div",Fe,[r("button",{class:"green",onClick:v[1]||(v[1]=m=>P())},"hit ⌘+<Enter> to go back"),o.bookings.length>0?(A(),B("div",Le)):J("",!0),q(L,{selectedBookingsToRender:o.bookings,konto:o.name},null,8,["selectedBookingsToRender","konto"])])])):(A(),B("div",Ne,[r("table",null,[(A(!0),B(U,null,H(i(y),m=>(A(),B("tr",null,[r("td",null,[X(p(m),1),r("a",{href:"#",onClick:S=>e(i(n).findAccount(m,"Kilometer"))},[r("div",null,"Kilometer: "+p(Math.abs(i(n).findAccount(m,"Kilometer").saldoY(i(s).currentPeriod)))+" km",1)],8,ze),r("div",null,[r("b",null,"Saldo: "+p(i(n).saldierenEuro(m))+" €",1)])]),r("td",null,[r("table",Ce,[Me,Oe,Te,Ge,(A(!0),B(U,null,H(i(z).accounts.filter(S=>S.Name!=="Kilometer"),S=>(A(),B("tr",Re,[r("td",Ve,[r("a",{href:"#",onClick:W=>e(i(n).findAccount(m,S.Name))},[r("span",null,p(S.Bezeichnung),1)],8,Ie),De]),r("td",$e,p(i(n).findAccount(m,S.Name).saldoY(i(s).currentPeriod)),1),r("td",Ye,p(i(n).findAccount(m,S.Name).saldoSoll(i(s).currentPeriod)),1),r("td",Ue,p(i(n).findAccount(m,S.Name).saldoHaben(i(s).currentPeriod)),1)]))),256))])])]))),256))])])),He,We])}}});const tt=ue(qe,[["__scopeId","data-v-7b6d2f89"]]);export{tt as default};
