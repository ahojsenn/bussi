import{G as ie,f as re,w as Z,o as E,b as K,i as n,h as se,x as ue,H as le,u as l,z as de,F as Q,s as X,t as _,j as W,q as me,k as pe,e as b,v as ee,C as he,D as fe,I as _e,a as ye}from"./entry.fd38c6db.js";import{P as Ae,l as M,_ as Se}from"./papaparse.min.c13abb20.js";import{U as ve,u as we}from"./hauptbuch.bc529629.js";import{u as Be}from"./stakeholder.9fe8b8a8.js";import{a as v,B as te}from"./types.3d83ab55.js";import{u as Pe}from"./accounts.f0733eb7.js";const Ee=t=>new Promise(function(p,c){Ae.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:p,error:c})}),Ke="/gviz/tq?tqx=out:csv",ke="&sheet=perioden",xe=ve+Ke+ke,oe=ie("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const t=await Ee(xe);this._perioden=t.data,this._currentPeriod=this._perioden[0].Periode},setPeriod(t){this._currentPeriod=t}},getters:{reparaturpauschale:t=>m=>t._perioden.find(p=>p.Periode===m).Reparaturpauschale,listOfPeriods:t=>t._perioden.map(m=>m.Periode),currentPeriod:t=>t._currentPeriod}}),ge={id:"my-global"},ze=re({__name:"YearSwitch",async setup(t){let m,p;const c=oe();[m,p]=Z(()=>c.loadDataFromGoogle()),await m,p();const e=c.listOfPeriods;let g=c.currentPeriod;const f=()=>{c.setPeriod(g)};return(w,r)=>(E(),K("form",ge,[n("span",null,[se("Welches Jahr möchtest du sehen?"),ue(n("select",{"onUpdate:modelValue":r[0]||(r[0]=z=>de(g)?g.value=z:g=z),onChange:r[1]||(r[1]=z=>f())},[(E(!0),K(Q,null,X(l(e),z=>(E(),K("option",null,_(z),1))),256))],544),[[le,l(g)]])])]))}}),x=(t,m,p)=>{if(t===null)return;const c=new v(t.nr,t.date,t.soll,t.haben,t.description,t.kmStart),e=new v(t.nr,t.date,t.haben,t.soll,t.description,t.kmStart);m.bookings.push(c),p.bookings.push(e)},q=t=>+(t.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(t.description)>0,ne=t=>t.toFixed(2).replace(".",",")+" €",Ne=t=>Math.round(t*100)/100,P=t=>typeof t=="string"?parseFloat(t.replaceAll(".","").replace("€","").trim().replace(",",".")):Number.isNaN(t)?0:t,Le=t=>q(t)?+t.liters.replace("l","").trim().replace(",","."):0;let Y=0,U=0;const Ce=(t,m,p,c)=>{M("bookEverythingtoBS: ",c.currentPeriod);for(var e of m){let f=!1;const w=p.shVerteilung(e.account).split(",");w.length>1;for(var g of w){const r=g.trim();if(q(e)&&(P(e.fuelPriceInEuro)&&(Y=Math.round(1e3*P(e.fuelPriceInEuro))/1e3),e.consumption&&+e.consumption!=0&&(U=Math.round(100*e.consumption)/100)),(o=>+o.key>0||o.key.indexOf("Reparatur")>-1)(e)){const o=t.findAccount(r,"Konto 3"),a=t.findAccount("Bussi","Konto 3"),i=P(e.amount)/w.length,A=e.account+" Reparatur "+e.description+" "+i+" "+e.amount,y=new v(e.nr,e.date,0,i,A,+e.km-+(e.kmSinceLastEntry||"0"));x(y,o,a),f=!0}if((o=>parseFloat(o.kmSinceLastEntry+"")!=0)(e)){const o=t.findAccount(r,"Kilometer"),a=t.findAccount("Bussi","Kilometer"),i=parseFloat(e.kmSinceLastEntry||"0")/w.length;+e.km-parseFloat(e.kmSinceLastEntry||"0");const y=Math.round(Y*i*U)/100,L=Math.round(100*+c.reparaturpauschale(c.currentPeriod).replace(",",".")*i)/100,I=e.account+" Kilometer "+i+" von "+e.kmSinceLastEntry+" km, "+r+"-->Bussi "+e.description+"<br>Benzingeld: "+y+" €, Reparaturgeld: "+L+" € für "+i+" km",T=new v(e.nr,e.date,i,0,I);x(T,o,a),f=!0;const s=t.findAccount(r,"Konto 2"),S=t.findAccount("Bussi","Konto 2"),C="Benzingeld: "+r+"-->Bussi, "+y+" € für "+i+" km, Benzinpreis: "+Y+"€/L, Verbrauch: "+U+" ="+Math.round(Y*U)/100+"€/km",N=new v(e.nr,e.date,y,0,C);x(N,s,S);const d=t.findAccount("Bussi","Konto 3"),h=t.findAccount(r,"Konto 3"),R=new v(e.nr,e.date,0,L,"Reparaturpauschale "+c.reparaturpauschale(c.currentPeriod)+" €/km * "+i+" km = "+L+" € : "+r+" --> Bussi");x(R,d,h)}if(q(e)){const o=Math.round(100*P(e.amount))/100,a=t.findAccount("Bussi","Konto 2"),i=t.findAccount(r,"Konto 2"),A=e.account+": Tanken für "+o+"€, "+Le(e)+" Liter, <br> Verbrauch: "+U+" l/100km, <br>"+r+"-->Bussi<br>Benzinpreis: "+Y+" €/l",y=P(e.amount)/w.length,L=new v(e.nr,e.date,y,0,A);x(L,a,i),f=!0}if((o=>o.key==="gleich")(e)){const o=t.findAccount(r,"Konto 1"),a=t.findAccount("Bussi","Konto 1"),i=P(e.amount)/w.length,A=e.account+" Konto 1 "+e.description+" "+i+" "+e.amount,y=new v(e.nr,e.date,0,i,A,+e.km);x(y,o,a),f=!0}const k=o=>{const a=e&&e.key&&typeof e.key=="string"&&e.key.split(" ").length>0?e.key.split(" ")[1]:"";return o.key.split(" ")[0]==="an"&&a!==""&&(a==="Bussi"||p.personen.indexOf(a)>=0)};if(k(e)){const o=t.findAccount(r,"Ausgleichskonto"),a=e.key.split(" ")[1],i=t.findAccount(a,"Ausgleichskonto"),A=e.account+"-->"+a+": "+e.description+" "+P(e.amount)+" "+e.amount,y=new v(e.nr,e.date,0,P(e.amount),A,+e.km);x(y,o,i),f=!0}if((o=>o.key.toLowerCase()==="jahresendbuchung")(e)){const o=e.description.match("[A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]* -> [A-Za-z0-9_.]*:[A-Za-z0-9_.]*.[0-9]*"),a=o?o[0]:"";if(a==="")return t;const i=a.split(" -> ")[0].split(":")[0],A=a.split(" -> ")[1].split(":")[0],y=a.split(" -> ")[0].split(":")[1],L=a.split(" -> ")[1].split(":")[1],I=t.findAccount(i,y),T=t.findAccount(A,L),s=new v(e.nr,e.date,P(e.amount),0,e.description,+e.km);x(s,I,T),f=!0}if(P(e.amount)===0&&+(e.kmSinceLastEntry||"0")==0&&(f=!0,M("Nullbuchung ignoriert: ",e)),!f){M("Fehler: ",e,k(e));const o=t.findAccount("System","Errors"),a=t.findAccount("System","Errors1"),i=e.account+" Konto 1 "+e.description+" <br> amount:"+e.amount+" "+P(e.amount)+"<br> kmSinceLastEntry:"+e.kmSinceLastEntry+"<br> splits:"+w+"<br> booking:"+JSON.stringify(e),A=new v(e.nr,e.date,0,P(e.amount),i,+e.km);x(A,o,a)}}}return t},O=t=>(he("data-v-ea8c6d6b"),t=t(),fe(),t),Fe={key:0},Me=O(()=>n("div",null," ",-1)),Oe={key:1},Re={class:"center"},Ge={key:0},Ie={key:2},Te=["onClick"],Ve={class:"inner",style:{width:"100%"}},De=O(()=>n("th",{class:"inner"},"Kontobezeichnung ",-1)),$e=O(()=>n("th",{class:"inner"},"Saldo ",-1)),Ye=O(()=>n("th",{class:"inner grey"},"Soll",-1)),Ue=O(()=>n("th",{class:"inner grey"},"Haben",-1)),je={class:"inner"},He={class:"inner"},We=["onClick"],Ze=O(()=>n("span",null,"     ",-1)),qe={class:"inner"},Je={class:"inner grey"},Qe={class:"inner grey"},Xe=O(()=>n("br",null,null,-1)),be=O(()=>n("br",null,null,-1)),et=re({__name:"balance",async setup(t){let m,p;const c=W({bookings:[],name:""}),e=s=>{const S=s.bookings;c.bookings.splice(0,c.bookings.length),c.bookings.push(...S),c.name=s.owner+" "+s.name},g=()=>{c.bookings=[],c.name=""};me(()=>{window.addEventListener("keydown",s=>{s.key==="Enter"&&s.metaKey&&g()})});const f=Be();[m,p]=Z(()=>f.loadStakeholder()),await m,p();const w=f.stakeholder.filter(s=>s.Verteilung.indexOf(",")===-1).map(s=>s.Verteilung),r=oe();[m,p]=Z(()=>r.loadDataFromGoogle()),await m,p(),M("balance.currentPeriod ",r.currentPeriod,r);const z=we(),G=Pe();[m,p]=Z(()=>G.loadDataFromGoogle()),await m,p(),G.accountBezeichnungen;const J=G.accountNames;let k=W(z.bookings),u=W(new te(w,J,k));u.findAccount("System","Errors");const o=_e();pe(r.$state,async(s,S)=>{await z.loadBussiData(r.currentPeriod),k=W(z.bookings),u=new te(w,J,k),u=Ce(u,k,f,r),u=I(u,k,f,r),u=T(u,k,f,r),o&&o.proxy&&o.proxy.$forceUpdate(),c.bookings=[],c.name=""});const a=()=>u.findAccount("Bussi","Kilometer").saldoY(r.currentPeriod),i=()=>Math.round(k.reduce((s,S)=>s+L(S),0)),A=()=>Math.round(100*i()*2.37/1e3)/100,y=()=>Math.round(i()/a()*1e4)/100,L=s=>q(s)?+s.liters.replace("l","").trim().replace(",","."):0;M("bs after bookEverythingtoBS",u);const I=(s,S,C,N)=>{const d=s.findAccount("Bussi","Konto 1"),h=Ne(-d.saldoY(N.currentPeriod)/C.personen.length);if(h===0)return s;for(var R of C.personen){const B=s.findAccount(R,"Konto 1"),F=new v("9999",N.currentPeriod+"-12-31",h,0,"Ausgleichsbuchung Konto1 "+N.currentPeriod+" "+B.owner+":"+B.name+" -> "+d.owner+":"+d.name);x(F,B,d)}return s},T=(s,S,C,N)=>{M("balanceSalden. allBookingsOfPeriod ",S);const d=s.saldierenEuro("Bussi"),h=C.personen.map(B=>{const F=s.saldierenEuro(B)+d/C.personen.length;return{name:B,saldo:F}});M("balanceSalden. stakeholdersSaldo ",h);let R=100;for(;R-- >0;){const B=h.reduce((D,$)=>D.saldo<$.saldo?D:$),F=h.reduce((D,$)=>D.saldo>$.saldo?D:$);if(B.saldo>=0||F.saldo<=0)break;const V=Math.min(-B.saldo,F.saldo),j=s.findAccount(F.name,"Ausgleichskonto"),H=s.findAccount(B.name,"Ausgleichskonto"),ce="Ausgleichsbuchung Salden <br>"+N.currentPeriod+" "+j.owner+":"+j.name+" -> "+H.owner+":"+H.name+"<br>Amount: "+ne(V)+"<br>konkret:  "+j.owner+" bekommt "+ne(V)+" von "+H.owner,ae=new v("9999",N.currentPeriod+"-12-31",V,0,ce);x(ae,j,H),B.saldo+=V,F.saldo-=V,M("balanceSalden. min ",B,"max ",F)}return s};return(s,S)=>{const C=ze,N=Se;return E(),K("div",null,[b(C),n("h1",null,"Bilanz "+_(l(r).currentPeriod)+", "+_(l(k).length)+" Buchungen ",1),l(u).findAccount("Bussi","Errors").bookings.length>0?(E(),K("div",Fe,[n("a",{class:"errors",href:"#",onClick:S[0]||(S[0]=d=>e(l(u).findAccount("Bussi","Errors")))}," Errors: "+_(l(u).findAccount("Bussi","Errors").bookings.length),1)])):ee("",!0),n("div",null,"Kilometer: "+_(a())+" km",1),n("div",null,"Benzin: "+_(i())+" Liter",1),n("div",null,"CO2: "+_(A())+" Tonnen CO2 ",1),n("div",null,"Verbrauch: "+_(y())+" Liter/100km",1),n("div",null,"Reparaturpauschale: "+_(l(r).reparaturpauschale("2022"))+"€",1),Me,c.bookings.length!=0?(E(),K("div",Oe,[n("div",Re,[n("button",{class:"green",onClick:S[1]||(S[1]=d=>g())},"hit ⌘+<Enter> to go back"),c.bookings.length>0?(E(),K("div",Ge)):ee("",!0),b(N,{selectedBookingsToRender:c.bookings,konto:c.name},null,8,["selectedBookingsToRender","konto"])])])):(E(),K("div",Ie,[n("table",null,[(E(!0),K(Q,null,X(l(w),d=>(E(),K("tr",null,[n("td",null,[se(_(d),1),n("a",{href:"#",onClick:h=>e(l(u).findAccount(d,"Kilometer"))},[n("div",null,"Kilometer: "+_(Math.abs(l(u).findAccount(d,"Kilometer").saldoY(l(r).currentPeriod)))+" km",1)],8,Te),n("div",null,[n("b",null,"Saldo: "+_(l(u).saldierenEuro(d))+" €",1)])]),n("td",null,[n("table",Ve,[De,$e,Ye,Ue,(E(!0),K(Q,null,X(l(G).accounts.filter(h=>h.Name!=="Kilometer"&&(h.Name!=="Konto 9000"||d==="Bussi")),h=>(E(),K("tr",je,[n("td",He,[n("a",{href:"#",onClick:R=>e(l(u).findAccount(d,h.Name))},[n("span",null,_(h.Bezeichnung),1)],8,We),Ze]),n("td",qe,_(l(u).findAccount(d,h.Name).saldoY(l(r).currentPeriod)),1),n("td",Je,_(l(u).findAccount(d,h.Name).saldoSoll(l(r).currentPeriod)),1),n("td",Qe,_(l(u).findAccount(d,h.Name).saldoHaben(l(r).currentPeriod)),1)]))),256))])])]))),256))])])),Xe,be])}}});const at=ye(et,[["__scopeId","data-v-ea8c6d6b"]]);export{at as default};
