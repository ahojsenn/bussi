import{E as ne,a as X,w as R,o as A,b as B,h as r,e as Z,s as re,G as se,u as i,x as oe,F as H,p as W,t as h,r as M,l as ce,m as ae,f as J,q as j,B as ie,C as le,H as ue,D as de}from"./entry.c565d9a4.js";import{P as me,l as T,_ as pe}from"./papaparse.min.ca0985d0.js";import{U as he,u as fe}from"./hauptbuch.44832143.js";import{u as _e}from"./stakeholder.9ef39eb8.js";import{a as P,B as Q}from"./types.9c14c63d.js";import{u as ye}from"./accounts.c936c625.js";import"./config.534cdd9e.js";const ve=t=>new Promise(function(d,p){me.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:d,error:p})}),Se="/gviz/tq?tqx=out:csv",Ae="&sheet=perioden",Be=he+Se+Ae,b=ne("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const t=await ve(Be);this._perioden=t.data,this._currentPeriod=this._perioden[t.data.length-2].Periode},setPeriod(t){this._currentPeriod=t}},getters:{reparaturpauschale:t=>l=>t._perioden.find(d=>d.Periode===l).Reparaturpauschale,listOfPeriods:t=>t._perioden.map(l=>l.Periode),currentPeriod:t=>t._currentPeriod}}),we={id:"my-global"},Pe=X({__name:"YearSwitch",async setup(t){let l,d;const p=b();[l,d]=R(()=>p.loadDataFromGoogle()),await l,d();const e=p.listOfPeriods;let w=p.currentPeriod;const v=()=>{p.setPeriod(w)};return(_,u)=>(A(),B("form",we,[r("span",null,[Z("Welches Jahr möchtest du sehen?"),re(r("select",{"onUpdate:modelValue":u[0]||(u[0]=a=>oe(w)?w.value=a:w=a),onChange:u[1]||(u[1]=a=>v())},[(A(!0),B(H,null,W(i(e),a=>(A(),B("option",null,h(a),1))),256))],544),[[se,i(w)]])])]))}}),k=(t,l,d)=>{if(t===null)return;const p=new P(t.nr,t.date,t.soll,t.haben,t.description,t.kmStart),e=new P(t.nr,t.date,t.haben,t.soll,t.description,t.kmStart);l.bookings.push(p),d.bookings.push(e)},ee=t=>+(t.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(t.description)>0,E=t=>typeof t=="string"?parseFloat(t.replaceAll(".","").replace("€","").trim().replace(",",".")):Number.isNaN(t)?0:t,U=t=>ee(t)?+t.liters.replace("l","").trim().replace(",","."):0,Ke=(t,l)=>Math.round(100*100*t/l)/100,Ee=t=>parseFloat(t.kmSinceLastFuelFill||"0");let C=0,O=0;const ke=(t,l,d,p)=>{T("bookEverythingtoBS: ",p.currentPeriod);for(var e of l){let v=!1;const _=d.shVerteilung(e.account).split(",");_.length>1;for(var w of _){const u=w.trim();if((o=>+o.key>0)(e)){const o=t.findAccount(u,"Konto 3"),n=t.findAccount("Bussi","Konto 3"),c=E(e.amount)/_.length,y=e.account+" Reparatur "+e.description+" "+c+" "+e.amount,f=new P(e.nr,e.date,0,c,y,+e.km-+(e.kmSinceLastEntry||"0"));k(f,o,n),v=!0}if(ee(e)){const o=Math.round(100*E(e.amount))/100;C=Math.round(1e3*o/U(e))/1e3,O=Ke(U(e),Ee(e));const n=t.findAccount("Bussi","Konto 2"),c=t.findAccount(u,"Konto 2"),y=e.account+": Tanken für "+o+"€, "+U(e)+" Liter, <br> Verbrauch: "+O+" l/100km, <br>"+u+"-->Bussi<br>Benzinpreis: "+C+" €/l",f=E(e.amount)/_.length,g=new P(e.nr,e.date,f,0,y);k(g,n,c),v=!0}if((o=>parseFloat(o.kmSinceLastEntry+"")!=0)(e)){const o=t.findAccount(u,"Kilometer"),n=t.findAccount("Bussi","Kilometer"),c=parseFloat(e.kmSinceLastEntry||"0")/_.length;+e.km-parseFloat(e.kmSinceLastEntry||"0");const f=Math.round(C*c*O)/100,g=Math.round(100*+p.reparaturpauschale(p.currentPeriod).replace(",",".")*c)/100,V=e.account+" Kilometer "+c+" von "+e.kmSinceLastEntry+" km, "+u+"-->Bussi "+e.description+"<br>Benzingeld: "+f+" €, Reparaturgeld: "+g+" € für "+c+" km",D=new P(e.nr,e.date,c,0,V);k(D,o,n),v=!0;const I=t.findAccount(u,"Konto 2"),$=t.findAccount("Bussi","Konto 2"),s="Benzingeld: "+f+" € für "+c+" km, Benzinpreis: "+C+"€/L, Verbrauch: "+O+" ergibt: "+Math.round(C*O)/100+" €/km",S=new P(e.nr,e.date,f,0,s);k(S,I,$);const L=t.findAccount("Bussi","Konto 3"),x=t.findAccount(u,"Konto 3"),m=new P(e.nr,e.date,0,g,"Reparaturpauschale "+p.reparaturpauschale(p.currentPeriod)+" €/km * "+c+" km = "+g+" € : "+u+" --> Bussi");k(m,L,x)}if((o=>o.key==="gleich")(e)){const o=t.findAccount(u,"Konto 1"),n=t.findAccount("Bussi","Konto 1"),c=E(e.amount)/_.length,y=e.account+" Konto 1 "+e.description+" "+c+" "+e.amount,f=new P(e.nr,e.date,0,c,y,+e.km);k(f,o,n),v=!0}const z=o=>{const n=e&&e.key&&typeof e.key=="string"&&e.key.split(" ").length>0?e.key.split(" ")[1]:"";return o.key.split(" ")[0]==="an"&&n!==""&&(n==="Bussi"||d.personen.indexOf(n)>=0)};if(z(e)){const o=t.findAccount(u,"Ausgleichskonto"),n=e.key.split(" ")[1],c=t.findAccount(n,"Ausgleichskonto"),y=e.account+" "+e.description+" "+E(e.amount)+" "+e.amount,f=new P(e.nr,e.date,0,E(e.amount),y,+e.km);k(f,o,c),v=!0}if(E(e.amount)===0&&+(e.kmSinceLastEntry||"0")==0&&(v=!0,T("Nullbuchung ignoriert: ",e)),!v){T("Fehler: ",e,z(e));const o=t.findAccount("System","Errors"),n=t.findAccount("System","Errors1"),c=e.account+" Konto 1 "+e.description+" <br> amount:"+e.amount+" "+E(e.amount)+"<br> kmSinceLastEntry:"+e.kmSinceLastEntry+"<br> splits:"+_+"<br> booking:"+JSON.stringify(e),y=new P(e.nr,e.date,0,E(e.amount),c,+e.km);k(y,o,n)}}}return t},F=t=>(ie("data-v-44707fb5"),t=t(),le(),t),ge={key:0},xe=F(()=>r("div",null," ",-1)),Fe={key:1},Le={class:"center"},Ne={key:0},ze={key:2},Ce=["onClick"],Oe={class:"inner",style:{width:"100%"}},Te=F(()=>r("th",{class:"inner z100z"},"Kontobezeichnung ",-1)),Ge=F(()=>r("th",{class:"inner"},"Saldo ",-1)),Me=F(()=>r("th",{class:"inner"},"Soll",-1)),Re=F(()=>r("th",{class:"inner"},"Haben",-1)),Ve={class:"inner"},De={class:"inner"},Ie=["onClick"],$e={class:"inner"},Ye={class:"inner"},Ue={class:"inner"},He=F(()=>r("br",null,null,-1)),We=F(()=>r("br",null,null,-1)),qe=X({__name:"balance",async setup(t){let l,d;const p=s=>s.length>60?s.substr(0,60)+"...":s,e=M({bookings:[],name:""}),w=s=>{const S=s.bookings;e.bookings.splice(0,e.bookings.length),e.bookings.push(...S),e.name=s.owner+" "+s.name},v=()=>{e.bookings=[],e.name=""};ce(()=>{window.addEventListener("keydown",s=>{s.key==="Enter"&&s.metaKey&&v()})});const _=_e();[l,d]=R(()=>_.loadStakeholder()),await l,d();const u=_.stakeholder.filter(s=>s.Verteilung.indexOf(",")===-1).map(s=>s.Verteilung),a=b();[l,d]=R(()=>a.loadDataFromGoogle()),await l,d(),T("balance.currentPeriod ",a.currentPeriod,a);const G=fe(),N=ye();[l,d]=R(()=>N.loadDataFromGoogle()),await l,d(),N.accountBezeichnungen;const z=N.accountNames;let o=M(G.bookings),n=M(new Q(u,z,o));n.findAccount("System","Errors");const c=ue();ae(a.$state,async(s,S)=>{await G.loadBussiData(a.currentPeriod),o=M(G.bookings),n=new Q(u,z,o),n=ke(n,o,_,a),n=$(n,o,_,a),c&&c.proxy&&c.proxy.$forceUpdate()});const y=()=>n.findAccount("Bussi","Kilometer").saldoY(a.currentPeriod),f=()=>Math.round(o.reduce((s,S)=>s+D(S),0)),g=()=>Math.round(100*f()*2.37/1e3)/100,V=()=>Math.round(f()/y()*1e4)/100,D=s=>I(s)?+s.liters.replace("l","").trim().replace(",","."):0,I=s=>+(s.kmSinceLastFuelFill||"0")!=0||"Tanken".indexOf(s.description)>0;T("bs after bookEverythingtoBS",n);const $=(s,S,L,x)=>{const m=s.findAccount("Bussi","Konto 1"),K=-m.saldoY(x.currentPeriod)/L.personen.length;for(var q of L.personen){const Y=s.findAccount(q,"Konto 1"),te=new P("9999",x.currentPeriod+"-12-31",0,K,"Ausgleichsbuchung Konto1 "+x.currentPeriod+" "+m.owner+":"+m.name+" -> "+Y.owner+":"+Y.name);k(te,m,Y)}return s};return(s,S)=>{const L=Pe,x=pe;return A(),B("div",null,[J(L),r("h1",null,"Bilanz "+h(i(a).currentPeriod)+", "+h(i(o).length)+" Buchungen ",1),i(n).findAccount("Bussi","Errors").bookings.length>0?(A(),B("div",ge,[r("a",{class:"errors",href:"#",onClick:S[0]||(S[0]=m=>w(i(n).findAccount("Bussi","Errors")))}," Errors: "+h(i(n).findAccount("Bussi","Errors").bookings.length),1)])):j("",!0),r("div",null,"Kilometer: "+h(y())+" km",1),r("div",null,"Benzin: "+h(f())+" Liter",1),r("div",null,"CO2: "+h(g())+" Tonnen CO2 ",1),r("div",null,"Verbrauch: "+h(V())+" Liter/100km",1),r("div",null,"Reparaturpauschale: "+h(i(a).reparaturpauschale("2022"))+"€",1),xe,e.bookings.length!=0?(A(),B("div",Fe,[r("div",Le,[r("button",{class:"green",onClick:S[1]||(S[1]=m=>v())},"hit ⌘+<Enter> to go back"),e.bookings.length>0?(A(),B("div",Ne)):j("",!0),J(x,{selectedBookingsToRender:e.bookings,konto:e.name},null,8,["selectedBookingsToRender","konto"])])])):(A(),B("div",ze,[r("table",null,[(A(!0),B(H,null,W(i(u),m=>(A(),B("tr",null,[r("td",null,[Z(h(m),1),r("a",{href:"#",onClick:K=>w(i(n).findAccount(m,"Kilometer"))},[r("div",null,"Kilometer: "+h(i(n).findAccount(m,"Kilometer").saldoY(i(a).currentPeriod))+" km",1)],8,Ce),r("div",null,[r("b",null,"Saldo: "+h(i(n).saldierenEuro(m))+" €",1)])]),r("td",null,[r("table",Oe,[Te,Ge,Me,Re,(A(!0),B(H,null,W(i(N).accounts.filter(K=>K.Name!=="Kilometer"),K=>(A(),B("tr",Ve,[r("td",De,[r("a",{href:"#",onClick:q=>w(i(n).findAccount(m,K.Name))},[r("span",null,h(p(K.Bezeichnung)),1)],8,Ie)]),r("td",$e,h(i(n).findAccount(m,K.Name).saldoY(i(a).currentPeriod)),1),r("td",Ye,h(i(n).findAccount(m,K.Name).saldoSoll(i(a).currentPeriod)),1),r("td",Ue,h(i(n).findAccount(m,K.Name).saldoHaben(i(a).currentPeriod)),1)]))),256))])])]))),256))])])),He,We])}}});const tt=de(qe,[["__scopeId","data-v-44707fb5"]]);export{tt as default};
