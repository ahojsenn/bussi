import{E as re,a as Z,w as T,o as _,b as A,h as r,e as b,s as oe,G as se,u as d,x as ae,F as U,p as W,t as p,r as z,l as ce,m as ue,f as j,q as Q,B as ie,C as le,H as de,D as me}from"./entry.d021a17a.js";import{P as pe,l as q,_ as he}from"./papaparse.min.71a5bd73.js";import{U as fe,u as _e}from"./hauptbuch.26c0aef6.js";import{u as Ae}from"./stakeholder.e848d068.js";import{a as w,A as ve,B as X}from"./types.42c77370.js";import{u as ye}from"./accounts.24718667.js";const Se=t=>new Promise(function(l,m){pe.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:l,error:m})}),we="/gviz/tq?tqx=out:csv",Be="&sheet=perioden",ke=fe+we+Be,ee=re("perioden",{state:()=>({_perioden:[],_currentPeriod:""}),actions:{async loadDataFromGoogle(){const t=await Se(ke);this._perioden=t.data,this._currentPeriod=this._perioden[t.data.length-2].Periode},setPeriod(t){this._currentPeriod=t}},getters:{reparaturpauschale:t=>a=>t._perioden.find(l=>l.Periode===a).Reparaturpauschale,listOfPeriods:t=>t._perioden.map(a=>a.Periode),currentPeriod:t=>t._currentPeriod}}),Pe={id:"my-global"},ge=Z({__name:"YearSwitch",async setup(t){let a,l;const m=ee();[a,l]=T(()=>m.loadDataFromGoogle()),await a,l();const e=m.listOfPeriods;let v=m.currentPeriod;const y=()=>{m.setPeriod(v)};return(S,i)=>(_(),A("form",Pe,[r("span",null,[b("Welches Jahr m\xF6chtest du sehen?"),oe(r("select",{"onUpdate:modelValue":i[0]||(i[0]=c=>ae(v)?v.value=c:v=c),onChange:i[1]||(i[1]=c=>y())},[(_(!0),A(U,null,W(d(e),c=>(_(),A("option",null,p(c),1))),256))],544),[[se,d(v)]])])]))}}),C=(t,a,l)=>{if(t===null)return;const m=new w(t.nr,t.date,t.soll,t.haben,t.description,t.kmStart,t.kmEnde,t.abschreibedauer),e=new w(t.nr,t.date,t.haben,t.soll,t.description,t.kmStart,t.kmEnde,t.abschreibedauer);a.bookings.push(m),l.bookings.push(e)},te=t=>+t.kmSinceLastFuelFill!=0||"Tanken".indexOf(t.description)>0,B=t=>typeof t=="string"?parseFloat(t.replace("\u20AC","").trim().replace(",",".")):Number.isNaN(t)?0:t,Y=t=>te(t)?+t.liters.replace("l","").trim().replace(",","."):0,Ce=(t,a)=>Math.round(100*100*t/a)/100,Ee=t=>parseFloat(t.kmSinceLastFuelFill);let R=0,O=0;const Ke=(t,a,l,m)=>{q("bookEverythingtoBS: ",m.currentPeriod);for(var e of a){let y=!1;const S=l.shVerteilung(e.account).split(",");S.length>1;for(var v of S){const i=v.trim();if((o=>+o.key>0)(e)){const o=t.findAccount(i,"Konto 3"),s=t.findAccount("Bussi","Konto 3"),u=e.account+" Reparatur "+e.description+" "+B(e.amount)+" "+e.amount,k=new w(e.nr,e.date,0,B(e.amount),u,+e.km-+e.kmSinceLastEntry);C(k,o,s),y=!0}if(te(e)){R=Math.round(1e3*B(e.amount)/Y(e))/1e3,O=Ce(Y(e),Ee(e));const o=t.findAccount("Bussi","Konto 2"),s=t.findAccount(i,"Konto 2"),u=e.account+" Tanken "+Y(e)+" Liter, <br> Verbrauch: "+O+" l/100km, <br>"+i+"-->Bussi<br>Benzinpreis: "+R+" \u20AC/l",k=B(e.amount)/S.length,P=new w(e.nr,e.date,k,0,u);C(P,o,s),y=!0}if((o=>parseFloat(o.kmSinceLastEntry)!=0)(e)){const o=t.findAccount(i,"Kilometer"),s=t.findAccount("Bussi","Kilometer"),u=parseFloat(e.kmSinceLastEntry)/S.length;+e.km-parseFloat(e.kmSinceLastEntry);const P=Math.round(R*u*O)/100,E=Math.round(100*+m.reparaturpauschale(m.currentPeriod).replace(",",".")*u)/100,G=e.account+" Kilometer "+u+" von "+e.kmSinceLastEntry+" km, "+i+"-->Bussi "+e.description+"<br>Benzingeld: "+P+" \u20AC, Reparaturgeld: "+E+" \u20AC f\xFCr "+u+" km",M=new w(e.nr,e.date,u,0,G);C(M,o,s),y=!0;const V=t.findAccount(i,"Ausgleichskonto"),D=t.findAccount("Bussi","Konto 2"),I="Benzingeld: "+P+" \u20AC f\xFCr "+u+" kmBenzinpreis = "+Math.round(R*O)/100+" \u20AC/km",n=new w(e.nr,e.date,P,0,I);C(n,V,D);const f=t.findAccount("Bussi","Konto 3"),x=t.findAccount(i,"Ausgleichskonto"),K=new w(e.nr,e.date,0,E,"Reparaturkosten aus Kilometern von "+m.reparaturpauschale(m.currentPeriod)+" \u20AC/km<br> Reparaturpauschale: "+E+" \u20AC f\xFCr "+u+" km<br> "+i+" --> Bussi");C(K,f,x)}if((o=>o.key==="gleich")(e)){const o=t.findAccount(i,"Konto 1"),s=t.findAccount("Bussi","Konto 1"),u=e.account+" Konto 1 "+e.description+" "+B(e.amount)+" "+e.amount,k=new w(e.nr,e.date,0,B(e.amount),u,+e.km);C(k,o,s),y=!0}B(e.amount)===0&&+e.kmSinceLastEntry==0&&(y=!0);const N=new ve("Nullkonto","Errors");if(!y){const o=t.findAccount("System","Errors"),s=e.account+" Konto 1 "+e.description+" <br> amount:"+e.amount+" "+B(e.amount)+"<br> kmSinceLastEntry:"+e.kmSinceLastEntry+"<br> splits:"+S+"<br> booking:"+JSON.stringify(e),u=new w(e.nr,e.date,0,B(e.amount),s,+e.km);C(u,o,N)}}}return t},H=t=>(ie("data-v-ab7c4a96"),t=t(),le(),t),xe={key:0},Fe=H(()=>r("div",null,"\xA0",-1)),Le={key:1},Ne={class:"center"},ze={key:0},Re={key:2},Oe=["onClick"],Te={class:"inner",style:{width:"100%"}},Ge=H(()=>r("th",{class:"inner z100z"},"Kontobezeichnung ",-1)),Me=H(()=>r("th",{class:"inner",style:{width:"25%"}},"Saldo ",-1)),Ve={class:"inner"},De={class:"inner"},Ie=["onClick"],$e={class:"inner"},Ye=Z({__name:"balance",async setup(t){let a,l;const m=n=>n.length>60?n.substr(0,60)+"...":n,e=z({bookings:[],name:""}),v=n=>{const f=n.bookings;e.bookings.splice(0,e.bookings.length),e.bookings.push(...f),e.name=n.owner+" "+n.name},y=()=>{e.bookings=[],e.name=""};ce(()=>{window.addEventListener("keydown",n=>{n.key==="Enter"&&n.metaKey&&y()})});const S=Ae();[a,l]=T(()=>S.loadStakeholder()),await a,l();const i=S.stakeholder.filter(n=>n.Verteilung.indexOf(",")===-1).map(n=>n.Verteilung),c=ee();[a,l]=T(()=>c.loadDataFromGoogle()),await a,l(),q("balance.currentPeriod ",c.currentPeriod,c);const L=_e(),F=ye();[a,l]=T(()=>F.loadDataFromGoogle()),await a,l(),F.accountBezeichnungen;const N=F.accountNames;let o=z(L.bookings),s=z(new X(i,N,o));const u=s.findAccount("Bussi","Errors"),k=de();ue(c.$state,async(n,f)=>{await L.loadBussiData(c.currentPeriod),o=z(L.bookings),s=new X(i,N,o),s=Ke(s,o,S,c),s=I(s,o,S,c),k.proxy.$forceUpdate()});const P=()=>s.findAccount("Bussi","Kilometer").saldoY(c.currentPeriod),E=()=>Math.round(o.reduce((n,f)=>n+V(f),0)),G=()=>Math.round(100*E()*2.37/1e3)/100,M=()=>Math.round(E()/P()*1e4)/100,V=n=>D(n)?+n.liters.replace("l","").trim().replace(",","."):0,D=n=>+n.kmSinceLastFuelFill!=0||"Tanken".indexOf(n.description)>0;q("bs after bookEverythingtoBS",s);const I=(n,f,x,K)=>{const h=n.findAccount("Bussi","Konto 1"),g=h.saldoY(K.currentPeriod)/x.personen.length;for(var J of x.personen){const $=n.findAccount(J,"Ausgleichskonto"),ne=new w("9999",K.currentPeriod+"-12-31",g,0,"Ausgleichsbuchung Konto1 "+K.currentPeriod+" "+h.owner+":"+h.name+" -> "+$.owner+":"+$.name);C(ne,h,$)}return n};return(n,f)=>{const x=ge,K=he;return _(),A("div",null,[j(x),r("h1",null,"Bilanz "+p(d(c).currentPeriod)+", "+p(d(o).length)+" Buchungen",1),d(u).bookings.length>0?(_(),A("div",xe,[r("a",{class:"errors",href:"#",onClick:f[0]||(f[0]=h=>v(d(u)))}," Errors: "+p(d(u).bookings.length),1)])):Q("",!0),r("div",null,"Kilometer: "+p(P())+" km",1),r("div",null,"Benzin: "+p(E())+" Liter",1),r("div",null,"CO2: "+p(G())+" Tonnen CO2 ",1),r("div",null,"Verbrauch: "+p(M())+" Liter/100km",1),r("div",null,"Reparaturpauschale: "+p(d(c).reparaturpauschale("2022"))+"\u20AC",1),Fe,e.bookings.length!=0?(_(),A("div",Le,[r("div",Ne,[r("button",{class:"green",onClick:f[1]||(f[1]=h=>y())},"hit \u2318+<Enter> to go back"),e.bookings.length>0?(_(),A("div",ze)):Q("",!0),j(K,{selectedBookingsToRender:e.bookings,konto:e.name},null,8,["selectedBookingsToRender","konto"])])])):(_(),A("div",Re,[r("table",null,[(_(!0),A(U,null,W(d(i),h=>(_(),A("tr",null,[r("td",null,[b(p(h),1),r("a",{href:"#",onClick:g=>v(d(s).findAccount(h,"Kilometer"))},[r("div",null,"Kilometer: "+p(d(s).findAccount(h,"Kilometer").saldoY(d(c).currentPeriod))+" km",1),r("div",null,"Saldo: "+p(d(s).saldierenEuro(h))+" \u20AC",1)],8,Oe)]),r("td",null,[r("table",Te,[Ge,Me,(_(!0),A(U,null,W(d(F).accounts.filter(g=>g.Name!=="Kilometer"),g=>(_(),A("tr",Ve,[r("td",De,[r("a",{href:"#",onClick:J=>v(d(s).findAccount(h,g.Name))},[r("span",null,p(m(g.Bezeichnung)),1)],8,Ie)]),r("td",$e,p(d(s).findAccount(h,g.Name).saldoY(d(c).currentPeriod)),1)]))),256))])])]))),256))])]))])}}});const Qe=me(Ye,[["__scopeId","data-v-ab7c4a96"]]);export{Qe as default};
